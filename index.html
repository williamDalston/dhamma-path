<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Dhamma Path</title>
    <meta name="description" content="A clear and practical guide to Theravāda Buddhism and mindfulness meditation. Explore core teachings, learn to meditate, and find your path to wisdom.">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Lora:ital,wght@0,400;0,500;0,700;1,400;1,500&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Custom Styles and Dark Mode Logic -->
    <style>
        :root {
            --linen-white: #FDFBF5;
            --charcoal: #333333;
            --forest-green: #4A6C55;
            --earthy-gold: #B98B4C;
            --light-gold: #EADDC7;
            --light-green: #E4EAE6;
            --gradient-primary: linear-gradient(135deg, #4A6C55 0%, #6B8E6B 100%);
            --gradient-secondary: linear-gradient(135deg, #B98B4C 0%, #D4A574 100%);
            --shadow-soft: 0 4px 20px rgba(74, 108, 85, 0.1);
            --shadow-hover: 0 8px 30px rgba(74, 108, 85, 0.15);
        }

        /* Light Mode */
        html {
            background-color: var(--linen-white);
            color: var(--charcoal);
        }

        /* Dark Mode */
        html.dark {
            background-color: #1a1a1a;
            color: #d1d1d1;
        }
        
        html.dark .bg-linen-white { background-color: #1a1a1a; }
        html.dark .text-charcoal { color: #d1d1d1; }
        html.dark .text-forest-green { color: #86b596; }
        html.dark .text-earthy-gold { color: #dcb981; }
        html.dark .border-earthy-gold { border-color: #dcb981; }
        html.dark .bg-light-gold { background-color: #3a3021; }
        html.dark .bg-light-green { background-color: #2c3a32; }
        html.dark .bg-charcoal { background-color: #111; }
        html.dark .fill-charcoal { fill: #d1d1d1; }
        html.dark nav, html.dark footer {
             background-color: #111;
             border-color: #444;
        }
        html.dark .hover\:bg-gray-100:hover {
            background-color: #333;
        }
         html.dark .logo-path {
            stroke: var(--linen-white);
        }
        html.dark .prose-p\:text-charcoal\/80 p { color: #d1d1d1; }
        html.dark .border-black\/5 { border-color: #ffffff1a; }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.8;
            font-size: 18px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }
        
        /* Performance optimizations */
        * {
            box-sizing: border-box;
        }
        
        .stagger-in {
            animation: fadeInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            opacity: 0;
            transform: translateY(30px);
        }
        
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .slide-in-left {
            animation: slideInLeft 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            opacity: 0;
            transform: translateX(-30px);
        }
        
        @keyframes slideInLeft {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .slide-in-right {
            animation: slideInRight 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            opacity: 0;
            transform: translateX(30px);
        }
        
        @keyframes slideInRight {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        /* Workout specific animations */
        .workout-pulse {
            animation: workoutPulse 2s ease-in-out infinite;
        }
        
        @keyframes workoutPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .workout-bounce {
            animation: workoutBounce 1s ease-in-out infinite;
        }
        
        @keyframes workoutBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .workout-shake {
            animation: workoutShake 0.5s ease-in-out;
        }
        
        @keyframes workoutShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        /* Smooth scrolling for better UX */
        html {
            scroll-behavior: smooth;
        }
        
        body.fullscreen-active #header, body.fullscreen-active footer { display: none; }
        body.fullscreen-active #main-content { padding-top: 2rem; padding-bottom: 2rem; height: 100vh; }


        h1, h2, h3, h4, h5, h6, .font-lora {
            font-family: 'Lora', serif;
        }
        
        /* Global Enhancements */
        .btn-primary { 
            @apply px-6 py-3 text-white font-semibold rounded-lg transition-all duration-300 transform hover:scale-105;
            background: var(--gradient-primary);
            box-shadow: var(--shadow-soft);
            display: inline-block !important;
            visibility: visible !important;
        }
        .btn-primary:hover {
            box-shadow: var(--shadow-hover);
        }
        .btn-secondary { 
            @apply px-6 py-3 bg-transparent border-2 border-earthy-gold text-earthy-gold font-semibold rounded-lg transition-all duration-300 transform hover:scale-105;
            background: linear-gradient(135deg, transparent 0%, rgba(185, 139, 76, 0.05) 100%);
        }
        .btn-secondary:hover {
            background: var(--gradient-secondary);
            color: white;
            border-color: transparent;
        }
        .btn-icon { 
            @apply p-3 bg-gray-200 text-charcoal rounded-full transition-all duration-300 transform hover:scale-110 dark:bg-gray-700 dark:hover:bg-gray-600;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .main-nav-link, .timer-duration-btn, button, .card-link {
            transition: all 0.4s ease-in-out;
        }
        .card-link {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: transform, box-shadow;
        }
        .card-link:hover {
             transform: translateY(-6px) scale(1.02);
             box-shadow: var(--shadow-hover);
        }
         html.dark .card-link:hover {
             box-shadow: 0 12px 40px rgba(0,0,0,0.3), 0 6px 12px rgba(0,0,0,0.2);
         }
        button:active {
            transform: scale(0.97);
        }
        
        .main-nav-link {
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .main-nav-link::before {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 50%;
            width: 0;
            height: 3px;
            background: var(--forest-green);
            border-radius: 2px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateX(-50%);
        }
        .main-nav-link:hover::before {
            width: 100%;
        }
        .main-nav-link.active {
            font-weight: 700;
            color: var(--forest-green);
        }
        .main-nav-link.active::before {
            width: 100%;
        }
        html.dark .main-nav-link.active { color: #86b596; }
        html.dark .main-nav-link::before { background: #86b596; }
        
        
        a:focus-visible, button:focus-visible, input:focus-visible, select:focus-visible, textarea:focus-visible {
            outline: 2px solid var(--earthy-gold);
            outline-offset: 2px;
            border-radius: 4px;
        }

        #skip-to-content {
            position: absolute;
            left: -9999px;
            top: auto;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }
        #skip-to-content:focus {
            position: fixed;
            top: 1rem;
            left: 1rem;
            width: auto;
            height: auto;
            padding: 0.5rem 1rem;
            background: var(--charcoal);
            color: var(--linen-white);
            z-index: 1000;
            border-radius: 6px;
        }
        
        /* Custom UI Elements */
        .article-content blockquote {
            border-left: 4px solid var(--earthy-gold);
            padding-left: 1.5rem;
            margin: 2rem 0;
            font-style: italic;
            font-family: 'Lora', serif;
            letter-spacing: 0.025em;
            color: #555;
        }
        html.dark .article-content blockquote {
            border-left-color: #dcb981;
            color: #aaa;
        }

        .call-out-box {
            background-color: var(--light-green);
            border-left: 4px solid var(--forest-green);
            padding: 1.5rem;
            margin: 2rem 0;
            border-radius: 0 8px 8px 0;
        }
        html.dark .call-out-box {
            background-color: #2c3a32;
            border-left-color: #86b596;
        }

        #progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            height: 4px;
            background-color: var(--forest-green);
            width: 0%;
            z-index: 100;
            transition: width 0.1s linear;
        }
        html.dark #progress-bar {
            background-color: #86b596;
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-in-out;
        }
        .stagger-in > * {
            animation: fadeIn 0.6s ease-in-out both;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Pali Term Tooltip */
        .pali-term {
            border-bottom: 2px dotted var(--earthy-gold);
            cursor: help;
            position: relative;
        }
        html.dark .pali-term { border-bottom-color: #dcb981; }

        .pali-tooltip {
            visibility: hidden;
            width: 250px;
            background-color: var(--charcoal);
            color: var(--linen-white);
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.4s;
        }
        html.dark .pali-tooltip { background-color: #f0f0f0; color: #111; }
        
        .pali-term:hover .pali-tooltip {
            visibility: visible;
            opacity: 1;
        }
        
        /* Meditation Timer Styles */
        .timer-ring-bg {
            stroke: var(--light-green);
        }
        .timer-ring-fg {
            stroke: var(--forest-green);
            transform: rotate(-90deg);
            transform-origin: center;
            transition: stroke-dashoffset 1s linear;
        }
        .timer-active .timer-ring-fg {
            animation: pulse-ring 2s infinite ease-in-out;
        }
        @keyframes pulse-ring {
            0%, 100% { stroke-opacity: 1; }
            50% { stroke-opacity: 0.7; }
        }
        html.dark .timer-ring-bg { stroke: #2c3a32; }
        html.dark .timer-ring-fg { stroke: #86b596; }
        
        /* Interview Recorder Styles */
        #live-video, #playback-video {
            transform: scaleX(-1); /* Mirror effect */
        }
        
        .recording-dot {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        /* Journal Focus Mode */
        .journal-focus #header, .journal-focus #footer {
            display: none;
        }
        .journal-focus #main-content {
            padding: 2rem 1rem;
            max-width: 100%;
        }
        .journal-focus #journal-container {
            max-width: 800px;
            margin: auto;
        }
    </style>
</head>
<body class="bg-linen-white text-charcoal transition-colors duration-300">
    <a href="#main-content" id="skip-to-content">Skip to main content</a>
    <div id="progress-bar"></div>
    
    <!-- Onboarding Modal -->
    <div id="onboarding-modal" class="hidden fixed inset-0 bg-black/60 z-[100] flex items-center justify-center p-4">
        <div class="bg-linen-white dark:bg-charcoal rounded-lg shadow-2xl max-w-lg w-full p-8 text-center fade-in">
            <h2 class="text-3xl font-bold font-lora text-forest-green mb-4">Welcome to The Dhamma Path</h2>
            <p class="text-charcoal/80 dark:text-gray-300 mb-6">To help you get started, what is your primary goal today?</p>
            <div class="space-y-4">
                <button class="onboarding-choice w-full p-4 bg-light-green hover:bg-green-200/50 dark:bg-gray-700 dark:hover:bg-gray-600 rounded-lg text-left">
                    <strong class="text-forest-green">Learn about Buddhism</strong>
                    <p class="text-sm text-charcoal/70 dark:text-gray-400">I'm new and want to understand the core concepts.</p>
                </button>
                <button class="onboarding-choice w-full p-4 bg-light-green hover:bg-green-200/50 dark:bg-gray-700 dark:hover:bg-gray-600 rounded-lg text-left">
                     <strong class="text-forest-green">Start Meditating</strong>
                    <p class="text-sm text-charcoal/70 dark:text-gray-400">I want to begin or deepen my meditation practice.</p>
                </button>
            </div>
            <button id="close-onboarding" class="mt-8 text-sm text-charcoal/60 dark:text-gray-400 hover:underline">Or, just explore the site</button>
        </div>
    </div>


    <!-- Header & Navigation -->
    <header id="header" class="bg-linen-white/80 backdrop-blur-lg sticky top-0 z-50 border-b border-gray-200/50 transition-all duration-300">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20 transition-all duration-300">
                <!-- Logo -->
                <a href="#" data-page="home" class="flex items-center space-x-2 main-nav-link">
                     <svg width="40" height="40" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" class="fill-charcoal transition-colors duration-300">
                        <defs>
                            <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:currentColor;stop-opacity:0.8" />
                                <stop offset="100%" style="stop-color:currentColor;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <circle cx="50" cy="50" r="45" fill="none" stroke="url(#logoGradient)" stroke-width="2" opacity="0.3"/>
                        <path class="logo-path" fill="url(#logoGradient)" stroke="none" d="M20 80 C 30 45, 50 30, 50 20 C 50 30, 60 40, 70 50 C 90 40, 80 70, 50 80 C 20 90, 30 50, 20 80 Z" />
                        <circle cx="50" cy="50" r="3" fill="currentColor" opacity="0.6"/>
                    </svg>
                    <span class="font-lora text-2xl font-bold text-charcoal">The Dhamma Path</span>
                </a>

                <!-- Desktop Nav -->
                <div id="desktop-nav-links" class="hidden md:flex items-center space-x-2">
                    <a href="#" data-page="category-meditation" class="main-nav-link text-charcoal hover:text-forest-green transition-colors px-4 py-3">Meditation</a>
                    <a href="#" data-page="timer" class="main-nav-link text-charcoal hover:text-forest-green transition-colors px-4 py-3">Meditation Timer</a>
                    <a href="#" data-page="journal" class="main-nav-link text-charcoal hover:text-forest-green transition-colors px-4 py-3">Mindful Journal</a>
                    <a href="#" data-page="workout" class="main-nav-link text-charcoal hover:text-forest-green transition-colors px-4 py-3">7-Minute Workout</a>
                    <a href="#" data-page="interview" class="main-nav-link text-charcoal hover:text-forest-green transition-colors px-4 py-3">Interview Practice</a>
                    <a href="#" data-page="glossary" class="main-nav-link text-charcoal hover:text-forest-green transition-colors px-4 py-3">Pāli Glossary</a>
                    <a href="#" data-page="about" class="main-nav-link text-charcoal hover:text-forest-green transition-colors px-4 py-3">About</a>
                    <div class="relative">
                        <input type="search" id="search-input" placeholder="Search teachings..." class="w-40 bg-gray-100 border border-transparent rounded-full px-4 py-1.5 focus:w-48 focus:bg-white focus:border-earthy-gold focus:outline-none transition-all duration-300 dark:bg-gray-700 dark:text-white">
                        <svg class="w-5 h-5 absolute right-3 top-1/2 -translate-y-1/2 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        <div id="autocomplete-results" class="hidden absolute top-full mt-2 w-64 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg"></div>
                    </div>
                    <button id="dark-mode-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                        <!-- Sun Icon -->
                        <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-earthy-gold" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
                        <!-- Moon Icon -->
                        <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden text-earthy-gold" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
                    </button>
                </div>

                <!-- Mobile Menu Button -->
                <div class="md:hidden flex items-center">
                    <button id="mobile-menu-button" class="inline-flex items-center justify-center p-2 rounded-md text-charcoal hover:text-forest-green focus:outline-none">
                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                        </svg>
                    </button>
                </div>
            </div>
        </nav>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="md:hidden hidden">
            <div id="mobile-nav-links" class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="#" data-page="category-meditation" class="main-nav-link text-charcoal hover:text-forest-green block px-3 py-2 rounded-md text-base font-medium">Meditation</a>
                <a href="#" data-page="timer" class="main-nav-link text-charcoal hover:text-forest-green block px-3 py-2 rounded-md text-base font-medium">Timer</a>
                <a href="#" data-page="journal" class="main-nav-link text-charcoal hover:text-forest-green block px-3 py-2 rounded-md text-base font-medium">Journal</a>
                <a href="#" data-page="workout" class="main-nav-link text-charcoal hover:text-forest-green block px-3 py-2 rounded-md text-base font-medium">Workout</a>
                <a href="#" data-page="interview" class="main-nav-link text-charcoal hover:text-forest-green block px-3 py-2 rounded-md text-base font-medium">Interview</a>
                <a href="#" data-page="glossary" class="main-nav-link text-charcoal hover:text-forest-green block px-3 py-2 rounded-md text-base font-medium">Glossary</a>
                <a href="#" data-page="about" class="main-nav-link text-charcoal hover:text-forest-green block px-3 py-2 rounded-md text-base font-medium">About</a>
                <div class="px-3 py-2">
                    <button id="dark-mode-toggle-mobile" class="w-full flex items-center justify-between p-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                        <span>Toggle Theme</span>
                        <div class="flex items-center">
                           <svg class="h-6 w-6 text-earthy-gold" fill="none" viewBox="0 0 24 24" stroke="currentColor"><use href="#sun-icon" /><use href="#moon-icon" /></svg>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Loading Indicator -->
    <div id="loading-indicator" class="fixed inset-0 bg-linen-white/90 backdrop-blur-sm z-50 flex items-center justify-center hidden">
        <div class="text-center">
            <div class="w-12 h-12 border-4 border-forest-green/20 border-t-forest-green rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-charcoal/70 font-medium">Loading...</p>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notification" class="fixed top-6 right-6 z-50 transform translate-x-full transition-transform duration-300">
        <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg px-6 py-4 max-w-sm">
            <div class="flex items-center space-x-3">
                <div class="flex-shrink-0">
                    <svg class="w-6 h-6 text-forest-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <div>
                    <p id="notification-text" class="text-sm font-medium text-charcoal dark:text-white"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Access Toolbar -->
    <div id="quick-access" class="fixed bottom-6 right-6 z-40 hidden">
        <div class="flex flex-col space-y-3">
            <button onclick="navigateTo('timer')" class="btn-icon" title="Meditation Timer (⌘T)">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </button>
            <button onclick="navigateTo('journal')" class="btn-icon" title="10-Minute Journal (⌘J)">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                </svg>
            </button>
            <button onclick="navigateTo('home')" class="btn-icon" title="Home (⌘H)">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                </svg>
            </button>
        </div>
    </div>

    <main id="main-content" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
        <!-- Page content will be injected here -->
    </main>
    
    <footer id="footer" class="bg-light-green border-t border-gray-200/80 transition-colors duration-300">
        <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div class="space-y-4 md:col-span-2">
                    <a href="#" data-page="home" class="main-nav-link flex items-center space-x-2">
                         <svg width="32" height="32" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" class="fill-charcoal transition-colors duration-300">
                             <defs>
                                 <linearGradient id="logoGradientMobile" x1="0%" y1="0%" x2="100%" y2="100%">
                                     <stop offset="0%" style="stop-color:currentColor;stop-opacity:0.8" />
                                     <stop offset="100%" style="stop-color:currentColor;stop-opacity:1" />
                                 </linearGradient>
                             </defs>
                             <circle cx="50" cy="50" r="45" fill="none" stroke="url(#logoGradientMobile)" stroke-width="2" opacity="0.3"/>
                             <path class="logo-path" fill="url(#logoGradientMobile)" stroke="none" d="M20 80 C 30 45, 50 30, 50 20 C 50 30, 60 40, 70 50 C 90 40, 80 70, 50 80 C 20 90, 30 50, 20 80 Z" />
                             <circle cx="50" cy="50" r="3" fill="currentColor" opacity="0.6"/>
                         </svg>
                        <span class="font-lora text-xl font-bold text-charcoal">The Dhamma Path</span>
                    </a>
                    <p class="text-charcoal/70">Your trusted companion on the path to inner peace through authentic Buddhist teachings and mindful living.</p>
                </div>
                <div>
                    <h3 class="text-sm font-semibold text-charcoal tracking-wider uppercase font-lora">Explore</h3>
                    <ul class="mt-4 space-y-2">
                        <li><a href="#" data-page="timer" class="main-nav-link text-base text-charcoal/80 hover:text-forest-green">Guided Meditation Timer</a></li>
                        <li><a href="#" data-page="journal" class="main-nav-link text-base text-charcoal/80 hover:text-forest-green">Mindful Freewriting</a></li>
                        <li><a href="#" data-page="workout" class="main-nav-link text-base text-charcoal/80 hover:text-forest-green">7-Minute Mindful Workout</a></li>
                        <li><a href="#" data-page="interview" class="main-nav-link text-base text-charcoal/80 hover:text-forest-green">Confident Interview Practice</a></li>
                        <li><a href="#" data-page="about" class="main-nav-link text-base text-charcoal/80 hover:text-forest-green">About Us</a></li>
                        <li><a href="#" data-page="glossary" class="main-nav-link text-base text-charcoal/80 hover:text-forest-green">Pāli Glossary</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-sm font-semibold text-charcoal tracking-wider uppercase font-lora">Legal</h3>
                    <ul class="mt-4 space-y-2">
                        <li><a href="#" data-page="privacy" class="main-nav-link text-base text-charcoal/80 hover:text-forest-green">Privacy Policy</a></li>
                        <li><a href="#" data-page="terms" class="main-nav-link text-base text-charcoal/80 hover:text-forest-green">Terms of Service</a></li>
                    </ul>
                </div>
            </div>
            <div class="mt-8 pt-8 border-t border-gray-300/50 text-center text-charcoal/60">
                <p>&copy; 2025 The Dhamma Path. All rights reserved.</p>
            </div>
        </div>
    </footer>


    <!-- TEMPLATES for dynamic content -->
    <template id="template-home">
        <div class="space-y-16 sm:space-y-24 max-w-5xl mx-auto">
            <!-- Hero Section -->
            <section class="text-left py-12 sm:py-20 rounded-lg bg-gradient-to-b from-light-green/50 to-linen-white dark:from-gray-800/20 dark:to-transparent">
                 <div class="max-w-3xl">
                    <h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold text-forest-green font-lora leading-tight">Discover Your Path to Inner Peace</h1>
                    <p class="mt-6 text-xl text-charcoal/80">Transform your daily life through the timeless wisdom of Theravāda Buddhism and the profound practice of mindfulness meditation.</p>
                 </div>
            </section>

            <!-- Start Your Journey -->
            <section>
                <h2 class="text-3xl font-bold text-center text-charcoal font-lora mb-10">Begin Your Transformative Journey</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 stagger-in">
                    <!-- Card 1 -->
                    <a href="#" data-page="category-introduction" class="main-nav-link card-link block p-8 bg-light-green rounded-lg shadow-sm duration-300 border border-black/5" style="animation-delay: 0.1s;">
                        <h3 class="text-2xl font-bold text-forest-green font-lora">Understanding Theravāda</h3>
                        <p class="mt-2 text-charcoal/80">Explore the ancient wisdom of the oldest Buddhist tradition and its timeless teachings for modern life.</p>
                    </a>
                    <!-- Card 2 -->
                    <a href="#" data-page="path" data-path-id="7-day-mindfulness" class="main-nav-link card-link block p-8 bg-light-gold rounded-lg shadow-sm duration-300 border border-black/5" style="animation-delay: 0.2s;">
                        <h3 class="text-2xl font-bold text-earthy-gold font-lora">7-Day Mindfulness Journey</h3>
                        <p class="mt-2 text-charcoal/80">Start your meditation practice with our carefully crafted beginner's guide to mindfulness.</p>
                    </a>
                    <!-- Card 3 -->
                    <a href="#" data-page="article" data-article-id="four-noble-truths" class="main-nav-link card-link block p-8 bg-light-green rounded-lg shadow-sm duration-300 border border-black/5" style="animation-delay: 0.3s;">
                        <h3 class="text-2xl font-bold text-forest-green font-lora">The Four Noble Truths</h3>
                        <p class="mt-2 text-charcoal/80">Discover the fundamental insights that illuminate the path to lasting happiness and freedom from suffering.</p>
                    </a>
                </div>
            </section>

            <!-- Latest Articles -->
            <section>
                 <h2 class="text-3xl font-bold text-center text-charcoal font-lora mb-10">Insights & Wisdom</h2>
                 <div id="latest-articles-grid" class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-12 stagger-in">
                    <!-- Article cards will be injected by JS -->
                 </div>
            </section>

             <!-- From the Canon -->
            <section class="bg-charcoal text-linen-white rounded-lg p-10 sm:p-16 text-center">
                <h2 class="text-3xl font-bold font-lora text-earthy-gold mb-6">From the Canon</h2>
                <blockquote class="text-2xl sm:text-3xl font-lora italic leading-relaxed">
                    "Just as a solid rock is not shaken by the wind, so are the wise unshaken by praise or blame."
                </blockquote>
                <cite class="block mt-6 text-lg text-linen-white/70 not-italic">- The Dhammapada, Verse 81</cite>
            </section>
        </div>
    </template>
    
    <template id="template-category">
        <div class="max-w-5xl mx-auto">
            <div class="text-center mb-12">
                <h1 id="category-title" class="text-4xl sm:text-5xl font-bold text-forest-green font-lora"></h1>
                <p id="category-description" class="mt-4 max-w-2xl mx-auto text-xl text-charcoal/80"></p>
            </div>
            <div id="category-paths-section" class="mb-16"></div>
            <div id="category-articles-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 stagger-in">
                <!-- Category article cards will be injected by JS -->
            </div>
        </div>
    </template>

    <template id="template-article">
        <article class="max-w-3xl mx-auto">
            <header class="text-center mb-10">
                <a href="#" id="article-category-link" data-page="" class="main-nav-link text-earthy-gold font-semibold uppercase tracking-wider"></a>
                <h1 id="article-title" class="text-4xl sm:text-5xl font-bold text-forest-green font-lora mt-2"></h1>
                <div class="mt-4 text-charcoal/60 text-sm flex justify-center items-center space-x-4">
                    <span>Last updated on <span id="article-date"></span></span> &bull; 
                    <span id="article-read-time"></span> min read
                    <button id="read-aloud-btn" class="flex items-center space-x-2 text-sm text-forest-green hover:underline">
                        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.114 5.636a9 9 0 010 12.728M16.463 8.288a5.25 5.25 0 010 7.424M6.75 8.25l4.72-4.72a.75.75 0 011.28.53v15.88a.75.75 0 01-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 012.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75z" /></svg>
                        <span>Read Aloud</span>
                    </button>
                </div>
            </header>
            
            <div id="audio-player-container" class="my-8"></div>

            <div id="article-toc" class="p-6 bg-light-gold rounded-lg my-8">
                <h3 class="text-xl font-bold font-lora text-earthy-gold mb-3">Table of Contents</h3>
                <ul id="toc-list" class="space-y-2"></ul>
            </div>
            
            <div id="article-content" class="article-content text-lg leading-relaxed space-y-6">
                <!-- Article content will be injected by JS -->
            </div>

            <hr class="my-12 border-gray-300/70 dark:border-gray-600">

            <!-- Author Bio -->
            <section id="author-bio" class="p-6 bg-light-green rounded-lg flex items-center space-x-6"></section>

            <!-- Related Articles -->
            <section id="related-articles" class="mt-16"></section>

            <!-- Comments Section -->
            <section id="comments-section" class="mt-16"></section>
        </article>
    </template>

    <template id="template-about">
        <div class="max-w-3xl mx-auto prose-p:text-charcoal/80">
            <header class="text-center mb-12">
            <h1 class="text-4xl sm:text-5xl font-bold text-forest-green font-lora">About The Dhamma Path</h1>
            <p class="mt-4 text-xl">We're dedicated to making the profound wisdom of the Buddha accessible, practical, and transformative for modern seekers.</p>
            </header>
            <div class="text-lg leading-relaxed space-y-6">
                <p>The Dhamma Path was born from a simple desire: to create a quiet, trustworthy space on the internet for exploring the teachings of Theravāda Buddhism. In a world of noise and distraction, we believe the path of mindfulness and wisdom offers a profound way to cultivate inner peace and clarity.</p>
                <p>Our founder, a long-term practitioner of Vipassanā meditation, found that many online resources were either too academic and dense for beginners, or too commercialized and disconnected from the original teachings. This website is an attempt to bridge that gap.</p>
                <h2 class="text-3xl font-bold text-charcoal font-lora !mt-12">Our Approach</h2>
                <p>We are committed to presenting the Dhamma (the teachings of the Buddha) as it is found in the Pāli Canon, the earliest collection of Buddhist scriptures. Our articles are written with three core principles in mind:</p>
                <ul class="list-disc list-inside space-y-2">
                    <li><strong>Authenticity:</strong> We ground our content in the suttas and the Theravāda tradition.</li>
                    <li><strong>Clarity:</strong> We strive to explain complex concepts in simple, practical language without sacrificing depth.</li>
                    <li><strong>Practicality:</strong> We emphasize how these ancient teachings can be applied to modern life to reduce stress and cultivate genuine well-being.</li>
                </ul>
                <p>This is not a commercial enterprise. It is a work of passion, offered freely for the benefit of all who are curious. We hope you find it helpful on your journey.</p>
            </div>
        </div>
    </template>
    
    <template id="template-glossary">
        <div class="max-w-4xl mx-auto">
            <header class="text-center mb-12">
            <h1 class="text-4xl sm:text-5xl font-bold text-forest-green font-lora">Pāli Glossary</h1>
            <p class="mt-4 max-w-2xl mx-auto text-xl text-charcoal/80">Deepen your understanding with clear definitions of key Buddhist terms from the ancient Pāli language.</p>
            </header>
            <div id="glossary-list" class="space-y-6 stagger-in">
                <!-- Glossary terms will be injected here -->
            </div>
        </div>
    </template>

    <template id="template-search-results">
        <div class="max-w-4xl mx-auto">
            <header class="text-center mb-12">
                <h1 class="text-4xl sm:text-5xl font-bold text-forest-green font-lora">Search Results</h1>
                <p id="search-results-query" class="mt-4 max-w-2xl mx-auto text-xl text-charcoal/80"></p>
            </header>
            <div id="search-results-list" class="space-y-8">
                <!-- Search results will be injected here -->
            </div>
        </div>
    </template>
    
    <template id="template-timer">
        <div class="max-w-xl mx-auto text-center">
            <h1 class="text-4xl sm:text-5xl font-bold text-forest-green font-lora mb-8">Guided Meditation Timer</h1>
            <div id="timer-ring-container" class="relative w-64 h-64 sm:w-80 sm:h-80 mx-auto mb-8">
                <svg class="w-full h-full" viewBox="0 0 100 100">
                    <circle class="timer-ring-bg" cx="50" cy="50" r="45" stroke-width="8" fill="transparent"></circle>
                    <circle id="timer-progress-ring" class="timer-ring-fg" cx="50" cy="50" r="45" stroke-width="8" fill="transparent" stroke-dasharray="283" stroke-dashoffset="283"></circle>
                </svg>
                <div id="timer-display" class="absolute inset-0 flex items-center justify-center text-6xl font-lora text-charcoal font-bold">10:00</div>
            </div>
            <div id="timer-controls">
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center mb-6">
                    <div>
                        <label for="duration-select" class="text-sm uppercase tracking-wider text-charcoal/70">Meditation Duration</label>
                        <div id="duration-buttons" class="flex flex-wrap justify-center gap-2 mt-2">
                            <button data-duration="5" class="timer-duration-btn px-4 py-2 rounded-full bg-forest-green text-white font-semibold transition hover:bg-forest-green/90">5 min</button>
                            <button data-duration="10" class="timer-duration-btn px-4 py-2 rounded-full bg-light-green text-forest-green transition hover:bg-light-green/80">10 min</button>
                            <button data-duration="15" class="timer-duration-btn px-4 py-2 rounded-full bg-light-green text-forest-green transition hover:bg-light-green/80">15 min</button>
                            <button data-duration="20" class="timer-duration-btn px-4 py-2 rounded-full bg-light-green text-forest-green transition hover:bg-light-green/80">20 min</button>
                            <button data-duration="30" class="timer-duration-btn px-4 py-2 rounded-full bg-light-green text-forest-green transition hover:bg-light-green/80">30 min</button>
                        </div>
                    </div>
                     <div>
                        <label for="sound-select" class="text-sm uppercase tracking-wider text-charcoal/70">Meditation Bell</label>
                        <select id="sound-select" class="mt-2 w-full p-2 border border-gray-300 rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 focus:ring-2 focus:ring-earthy-gold focus:outline-none">
                            <option value="chime">Gentle Chime</option>
                            <option value="bowl">Tibetan Singing Bowl</option>
                            <option value="wood">Wooden Meditation Block</option>
                        </select>
                    </div>
                </div>
                <div class="flex items-center justify-center space-x-4">
                    <button id="timer-start-btn" class="px-10 py-5 bg-forest-green text-white font-bold rounded-xl hover:bg-forest-green/90 transition text-2xl shadow-xl transform hover:scale-105">Begin Meditation</button>
                    <button id="timer-pause-btn" class="px-8 py-4 bg-earthy-gold text-white font-semibold rounded-lg hover:bg-earthy-gold/90 transition text-xl hidden shadow-lg">Pause Session</button>
                    <button id="timer-reset-btn" class="p-4 bg-gray-200 text-charcoal rounded-full hover:bg-gray-300 transition dark:bg-gray-700 dark:hover:bg-gray-600">
                        <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h5M20 20v-5h-5M4 4l1.5 1.5A9 9 0 0120.5 15M20 20l-1.5-1.5A9 9 0 003.5 9"></path></svg>
                    </button>
                </div>
            </div>
            <div id="practice-log" class="mt-12 text-left bg-light-green p-6 rounded-lg"></div>
        </div>
    </template>
    
    <template id="template-path">
        <div class="max-w-4xl mx-auto">
            <header class="text-center mb-12">
                <p class="text-earthy-gold font-semibold uppercase tracking-wider">Guided Path</p>
                <h1 id="path-title" class="text-4xl sm:text-5xl font-bold text-forest-green font-lora mt-2"></h1>
                <p id="path-description" class="mt-4 max-w-2xl mx-auto text-xl text-charcoal/80"></p>
            </header>
            <div id="path-steps-list" class="space-y-4 stagger-in">
                <!-- Path steps will be injected here -->
            </div>
        </div>
    </template>
    
    <template id="template-workout">
        <div class="max-w-6xl mx-auto">
            <header class="text-center mb-12">
            <h1 class="text-4xl sm:text-5xl font-bold text-forest-green font-lora">7-Minute Mindful Workout</h1>
            <p class="mt-4 max-w-2xl mx-auto text-xl text-charcoal/80">Strengthen your body and mind with this efficient, high-intensity circuit training designed for busy schedules.</p>
            </header>
            
            <!-- Workout Settings -->
            <div class="bg-light-green rounded-lg p-6 mb-8">
                <div class="flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0">
                    <div class="flex items-center space-x-6">
                        <div class="flex items-center space-x-3">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" id="workout-double-mode" class="h-4 w-4 rounded text-forest-green focus:ring-forest-green">
                                <span class="font-medium text-charcoal">14-Minute Mode</span>
                            </label>
                        </div>
                        <div class="flex items-center space-x-3">
                            <label for="workout-sound" class="text-sm font-medium text-charcoal">Sound:</label>
                            <select id="workout-sound" class="px-3 py-2 border border-gray-300/50 rounded-lg focus:ring-2 focus:ring-earthy-gold focus:outline-none dark:bg-gray-800 dark:border-gray-600">
                                <option value="on">On</option>
                                <option value="off">Off</option>
                            </select>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-sm text-charcoal/70">
                            <span id="workout-progress-text">Exercise 1 of 12</span>
                        </div>
                        <div class="w-32 bg-gray-200 rounded-full h-2 dark:bg-gray-700">
                            <div id="workout-progress-bar" class="bg-forest-green h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Workout Display -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
                <!-- Exercise Visual -->
                <div class="order-2 lg:order-1">
                    <div id="workout-visual" class="bg-light-green rounded-lg p-8 flex items-center justify-center h-80 lg:h-96">
                        <!-- SVG Animation will be injected here -->
                    </div>
                    
                    <!-- Exercise Instructions -->
                    <div id="workout-instructions" class="mt-6 p-6 bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-black/5">
                        <h3 class="text-lg font-semibold text-charcoal mb-2">Instructions</h3>
                        <p id="workout-instruction-text" class="text-charcoal/80">Get ready to start with jumping jacks. Stand with feet together and arms at your sides.</p>
                    </div>
                </div>

                <!-- Workout Controls -->
                <div class="order-1 lg:order-2">
                    <div id="workout-display" class="p-8 bg-light-green rounded-lg shadow-sm">
                        <div class="text-center">
                            <p id="workout-status" class="text-xl font-semibold text-earthy-gold uppercase tracking-wider mb-2">Get Ready!</p>
                            <h2 id="workout-exercise" class="text-4xl font-bold font-lora text-charcoal mb-4">Jumping Jacks</h2>
                            <div id="workout-timer" class="text-8xl font-lora text-forest-green mb-4">10</div>
                            <div id="workout-phase" class="text-lg text-charcoal/70">Rest</div>
                        </div>
                    </div>
                    
                    <div id="workout-next" class="text-center mt-6 p-4 bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-black/5">
                        <span class="text-sm text-charcoal/60">Next up:</span>
                        <div id="workout-next-exercise" class="text-lg font-medium text-charcoal">Wall Sit</div>
                    </div>
                    
                    <!-- Workout Controls -->
                    <div id="workout-controls" class="mt-8 flex items-center justify-center space-x-4">
                        <button id="workout-back-btn" class="btn-icon" title="Previous Exercise">
                            <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" /></svg>
                        </button>
                        <button id="workout-start-btn" class="px-10 py-5 bg-forest-green text-white font-bold rounded-xl hover:bg-forest-green/90 transition text-2xl shadow-xl transform hover:scale-105">Begin Workout</button>
                        <button id="workout-pause-btn" class="px-8 py-4 bg-earthy-gold text-white font-semibold rounded-lg hover:bg-earthy-gold/90 transition text-xl hidden shadow-lg">Pause Session</button>
                        <button id="workout-forward-btn" class="btn-icon" title="Next Exercise">
                            <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" /></svg>
                        </button>
                    </div>
                    
                    <!-- Workout Stats -->
                    <div id="workout-stats" class="mt-6 grid grid-cols-3 gap-4 text-center">
                        <div class="p-4 bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-black/5">
                            <div id="workout-total-time" class="text-2xl font-bold text-forest-green">0:00</div>
                            <div class="text-sm text-charcoal/70">Total Time</div>
                        </div>
                        <div class="p-4 bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-black/5">
                            <div id="workout-calories" class="text-2xl font-bold text-earthy-gold">0</div>
                            <div class="text-sm text-charcoal/70">Calories</div>
                        </div>
                        <div class="p-4 bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-black/5">
                            <div id="workout-completed" class="text-2xl font-bold text-forest-green">0/12</div>
                            <div class="text-sm text-charcoal/70">Completed</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>
    
    <template id="template-interview">
        <div class="max-w-5xl mx-auto">
            <header class="text-center mb-12">
            <h1 class="text-4xl sm:text-5xl font-bold text-forest-green font-lora">Morning Confidence Practice</h1>
            <p class="mt-4 max-w-2xl mx-auto text-xl text-charcoal/80">Start your day with confidence! Practice speaking skills, build self-assurance, and prepare for any conversation with our quick morning practice sessions.</p>
            </header>
            
            <!-- Quick Morning Practice Options -->
            <div class="bg-earthy-gold/10 p-6 rounded-lg mb-8">
                <h3 class="text-lg font-semibold text-charcoal mb-4 text-center">Choose Your Morning Practice</h3>
                <div class="flex flex-wrap justify-center gap-3">
                    <button data-category="general" class="interview-cat-btn px-6 py-3 bg-forest-green text-white font-semibold rounded-lg hover:bg-forest-green/90 transition shadow-lg">Daily Conversations</button>
                    <button data-category="behavioral" class="interview-cat-btn px-6 py-3 bg-earthy-gold text-white font-semibold rounded-lg hover:bg-earthy-gold/90 transition shadow-lg">Professional Skills</button>
                    <button data-category="presentation" class="interview-cat-btn px-6 py-3 bg-light-green text-forest-green font-semibold rounded-lg hover:bg-light-green/80 transition shadow-lg">Presentation Practice</button>
                </div>
            </div>

            <div id="interview-question-box" class="p-6 bg-light-gold rounded-lg text-center mb-8">
                <h2 id="interview-question" class="text-2xl font-lora text-earthy-gold">Tell me about yourself.</h2>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Recording Side -->
                <div>
                    <h3 class="text-2xl font-bold font-lora text-charcoal mb-4 text-center">Your Camera</h3>
                    <div id="recorder-section">
                        <div class="relative">
                            <video id="live-video" class="w-full bg-gray-200 dark:bg-gray-800 rounded-lg aspect-video" autoplay muted></video>
                            <div id="camera-error" class="hidden absolute inset-0 bg-black/70 text-white flex flex-col items-center justify-center p-4">
                                <h4 class="font-bold text-lg">Camera Error</h4>
                                <p class="text-sm text-center">Could not access camera and microphone. Please check your browser permissions and try again.</p>
                            </div>
                        </div>
                        <div id="recorder-controls" class="mt-4 flex items-center justify-center space-x-4">
                    <button id="start-recording-btn" class="px-10 py-5 bg-forest-green text-white font-bold rounded-xl hover:bg-forest-green/90 transition text-xl shadow-xl transform hover:scale-105">Start Morning Practice</button>
                    <button id="stop-recording-btn" class="px-8 py-4 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition text-lg hidden shadow-lg">
                        <span class="flex items-center"><span class="w-3 h-3 bg-white rounded-full mr-2 recording-dot"></span>End Recording</span>
                    </button>
                        </div>
                    </div>
                </div>
                <!-- Playback Side -->
                <div>
                    <h3 class="text-2xl font-bold font-lora text-charcoal mb-4 text-center">Session Recordings</h3>
                    <div id="playback-section" class="space-y-4">
                         <div id="no-recordings-message" class="text-center p-8 bg-light-green rounded-lg text-charcoal/70">
                             Your recordings for this session will appear here.
                         </div>
                         <div id="recordings-list"></div>
                         <video id="playback-video" class="w-full bg-gray-200 dark:bg-gray-800 rounded-lg hidden aspect-video" controls></video>
                         <div id="interview-feedback" class="hidden text-center p-4 bg-light-green rounded-lg text-charcoal/80 mt-4"></div>
                    </div>
                </div>
            </div>
            
            <div class="text-center mt-8">
                <button id="next-question-btn" class="px-6 py-3 bg-earthy-gold text-white font-semibold rounded-lg hover:bg-earthy-gold/90 transition">Practice Next Question</button>
            </div>
        </div>
    </template>
    
    <template id="template-journal">
        <div class="max-w-4xl mx-auto">
            <header class="text-center mb-12">
            <h1 class="text-4xl sm:text-5xl font-bold text-forest-green font-lora">Mindful Freewriting</h1>
            <p class="mt-4 max-w-2xl mx-auto text-xl text-charcoal/80">Cultivate self-awareness through stream-of-consciousness writing. Let your thoughts flow freely for your chosen duration—everything saves automatically.</p>
            </header>
            
            <!-- Quick Morning Presets -->
            <div class="bg-earthy-gold/10 p-4 rounded-lg mb-4">
                <h3 class="text-lg font-semibold text-charcoal mb-3 text-center">Quick Morning Presets</h3>
                <div class="flex flex-wrap justify-center gap-3">
                    <button class="quick-preset-btn px-6 py-3 bg-forest-green text-white font-semibold rounded-lg hover:bg-forest-green/90 transition shadow-lg" data-duration="300">5-Min Quick</button>
                    <button class="quick-preset-btn px-6 py-3 bg-earthy-gold text-white font-semibold rounded-lg hover:bg-earthy-gold/90 transition shadow-lg" data-duration="600">10-Min Standard</button>
                    <button class="quick-preset-btn px-6 py-3 bg-light-green text-forest-green font-semibold rounded-lg hover:bg-light-green/80 transition shadow-lg" data-duration="900">15-Min Deep</button>
                </div>
            </div>
            
            <div class="bg-light-green p-6 rounded-lg shadow-sm mb-6">
                <div class="flex flex-col lg:flex-row justify-between items-center mb-4 space-y-4 lg:space-y-0">
                    <div class="flex items-center space-x-4">
                        <div id="journal-timer" class="text-3xl font-lora text-forest-green font-bold">10:00</div>
                        <div class="text-sm text-charcoal/70">remaining</div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <label for="timer-duration" class="text-sm font-medium text-charcoal">Custom Duration:</label>
                        <select id="timer-duration" class="px-4 py-2 border border-gray-300/50 rounded-lg focus:ring-2 focus:ring-earthy-gold focus:outline-none dark:bg-gray-800 dark:border-gray-600 bg-white">
                            <option value="300">5 minutes</option>
                            <option value="600" selected>10 minutes</option>
                            <option value="900">15 minutes</option>
                            <option value="1200">20 minutes</option>
                            <option value="1800">30 minutes</option>
                            <option value="3600">1 hour</option>
                        </select>
                    </div>
                    <button id="journal-start-btn" class="px-10 py-5 bg-forest-green text-white font-bold rounded-xl hover:bg-forest-green/90 transition text-xl shadow-xl transform hover:scale-105 w-full lg:w-auto">Begin Freewriting</button>
                </div>
                <textarea id="journal-entry" placeholder="Let your thoughts flow freely... the timer will begin as soon as you start typing." class="w-full h-64 p-4 border border-gray-300/50 rounded-lg focus:ring-2 focus:ring-earthy-gold focus:outline-none dark:bg-gray-800 dark:border-gray-600" style="font-family: 'Lora', serif; font-size: 1.1rem; line-height: 1.8;"></textarea>
            </div>

            <div id="journal-history" class="mt-12">
                <h2 class="text-3xl font-bold text-charcoal font-lora mb-6 text-center">Your Entries</h2>
                <div id="journal-history-list" class="space-y-6">
                    <!-- Saved entries will be injected here -->
                </div>
            </div>
        </div>
    </template>


    <script>
    // --- DATABASE --- //
    const db = {
        articles: {
            "what-is-theravada": {
                title: "What Is Theravāda Buddhism? A Simple Guide",
                category: "Introduction",
                categoryId: "introduction",
                date: "September 10, 2025",
                readTime: 8,
                author: "Alan Dhamma",
                tags: ["theravada", "buddhism", "introduction"],
                content: `
                    <p><span class="pali-term" data-term="theravada">Theravāda</span>, which means "The Way of the Elders" in the Pāli language, is the oldest surviving school of Buddhism. It is widely considered to be the most faithful representation of the original teachings of Siddhartha Gautama, the Buddha. For over two millennia, its traditions have been passed down from teacher to student, preserving a path of wisdom that is both profound and practical.</p>
                    <h2>The Foundation: The Pāli Canon</h2>
                    <p>The core of Theravāda Buddhism is the Pāli Canon, the most complete and earliest collection of the Buddha's discourses. This vast body of texts, known as the Tipiṭaka (or "Three Baskets"), is organized into three main sections:</p>
                    <ul>
                        <li><strong>Vinaya Piṭaka:</strong> The code of monastic discipline for monks and nuns.</li>
                        <li><strong>Sutta Piṭaka:</strong> The collection of discourses and sermons delivered by the Buddha and his senior disciples. This is the heart of the teachings.</li>
                        <li><strong>Abhidhamma Piṭaka:</strong> A detailed philosophical and psychological analysis of the nature of mind and matter.</li>
                    </ul>
                    <p>Unlike some other Buddhist schools, Theravāda does not recognize later scriptures or sutras as canonical. It holds that the path to liberation is found within these original teachings.</p>
                    <blockquote>"Ardently do today what must be done. Who knows? Tomorrow, death comes."</blockquote>
                    <h2>Core Beliefs: The Three Marks of Existence</h2>
                    <p>At the heart of Theravāda philosophy are the Three Marks of Existence (Tilakkhaṇa), the fundamental characteristics of all conditioned phenomena:</p>
                    <ol>
                        <li><strong><span class="pali-term" data-term="anicca">Anicca</span> (Impermanence):</strong> Everything is in a constant state of flux. Nothing lasts forever.</li>
                        <li><strong><span class="pali-term" data-term="dukkha">Dukkha</span> (Unsatisfactoriness):</strong> Because things are impermanent, clinging to them inevitably leads to suffering or a subtle sense of dissatisfaction.</li>
                        <li><strong><span class="pali-term" data-term="anatta">Anattā</span> (Not-Self):</strong> There is no permanent, unchanging, independent self or soul. What we call "I" is merely a temporary combination of physical and mental components.</li>
                    </ol>
                    <div class="call-out-box">
                        <p><strong>Key Takeaway:</strong> Understanding these three truths on an experiential level, not just an intellectual one, is the key to liberation in Theravāda Buddhism. This insight is cultivated through meditation.</p>
                    </div>
                    <h2>The Path to Liberation: The Noble Eightfold Path</h2>
                    <p>The Buddha taught that the way to end suffering is to follow the Noble Eightfold Path. This isn't a linear sequence of steps, but rather eight interconnected factors that should be developed simultaneously. They are grouped into three divisions: Wisdom (<span class="pali-term" data-term="panna">Paññā</span>), Ethical Conduct (Sīla), and Mental Discipline (<span class="pali-term" data-term="samadhi">Samādhi</span>).</p>
                    <p>By cultivating this path, practitioners aim to achieve the ultimate goal: <span class="pali-term" data-term="nibbana">Nibbāna</span> (Nirvana), the complete cessation of suffering and the cycle of rebirth.</p>
                `
            },
            "vipassana-guide": {
                title: "How to Practice Vipassanā: A Beginner's Guide",
                category: "Meditation",
                categoryId: "meditation",
                date: "September 8, 2025",
                readTime: 10,
                author: "Jane Bodhi",
                tags: ["meditation", "vipassana", "mindfulness", "guide"],
                audioSrc: null, // Audio will be generated programmatically
                content: `
                    <p><span class="pali-term" data-term="vipassana">Vipassanā</span>, which means "to see things as they really are," is one of India's most ancient meditation techniques. It is a process of self-observation, a journey to the common root of mind and body that dissolves mental impurity, resulting in a balanced mind full of love and compassion.</p>
                    <h2>Preparing for Your Practice</h2>
                    <p>Before you begin, find a quiet place where you won't be disturbed for 15-20 minutes. Sit in a comfortable position, either on a cushion on the floor with your legs crossed or upright in a chair with your feet flat on the ground. The key is to keep your back straight but not stiff. Close your eyes gently.</p>
                    <h2>The Practice: Mindfulness of Breath (<span class="pali-term" data-term="anapanasati">Ānāpānasati</span>)</h2>
                    <p>The foundation of Vipassanā practice is mindfulness of breath. This is your anchor to the present moment.</p>
                    <ol>
                        <li><strong>Bring your attention to your breath.</strong> Observe the natural, normal sensation of the breath as it enters and leaves your nostrils. Don't try to control or change it. Just observe.</li>
                        <li><strong>Focus on the sensation.</strong> Notice the feeling of the air touching the inside of your nostrils or the area of your upper lip. Stay with this sensation.</li>
                        <li><strong>When the mind wanders, gently bring it back.</strong> And it will wander. Thoughts, sounds, or physical sensations will pull your attention away. This is normal. The moment you realize your mind has wandered, without any judgment or frustration, gently guide your attention back to the sensation of the breath.</li>
                    </ol>
                    <blockquote>"The breath is the bridge which connects life to consciousness, which unites your body to your thoughts."</blockquote>
                    <h2>Expanding Awareness: Body Scan</h2>
                    <p>Once you have developed some stability with the breath, you can begin to expand your awareness to the entire body. Systematically move your attention through your body, from the top of your head to the tips of your toes, observing whatever sensations arise.</p>
                    <p>You might feel tingling, warmth, pressure, or nothing at all. Whatever the sensation, simply observe it with a balanced, equanimous mind. The goal is to understand the impermanent nature of all sensations without reacting to them with craving or aversion.</p>
                    <div class="call-out-box">
                        <p><strong>Key Insight:</strong> The practice is not about having pleasant sensations. It's about developing equanimity—the ability to observe your experience without being controlled by it.</p>
                    </div>
                    <p>End your session by taking a few moments to sit quietly, letting go of the technique. Then, when you are ready, gently open your eyes.</p>
                `
            },
            "four-noble-truths": {
                title: "The Four Noble Truths Explained",
                category: "Core Teachings",
                categoryId: "teachings",
                date: "September 5, 2025",
                readTime: 7,
                author: "Alan Dhamma",
                tags: ["theravada", "teachings", "four noble truths", "dukkha"],
                content: `
                    <p>The Four Noble Truths are the very first teaching the Buddha gave after his enlightenment. They are the foundation of all Buddhist traditions and provide a framework for understanding the nature of our experience and the path to liberation.</p>
                    <h2>1. The Truth of Suffering (<span class="pali-term" data-term="dukkha">Dukkha</span>)</h2>
                    <p>The first truth acknowledges that life inevitably contains suffering. This isn't a pessimistic view but a realistic one. It includes obvious suffering like pain, old age, and sickness, but also more subtle forms of dissatisfaction, like the stress of not getting what we want or the anxiety of holding onto what we have.</p>
                    <h2>2. The Truth of the Origin of Suffering (Samudāya)</h2>
                    <p>The second truth identifies the cause of suffering: craving and clinging (Taṇhā). We suffer because we cling to things, ideas, and even our sense of self, wishing they were permanent when they are not. This craving comes in three forms:</p>
                    <ul>
                        <li>Craving for sense pleasures.</li>
                        <li>Craving for existence and becoming.</li>
                        <li>Craving for non-existence.</li>
                    </ul>
                    <blockquote>"The root of suffering is attachment."</blockquote>
                    <h2>3. The Truth of the Cessation of Suffering (Nirodhha)</h2>
                    <p>The third truth is the good news: there is an end to suffering. By eliminating craving and clinging, we can attain <span class="pali-term" data-term="nibbana">Nibbāna</span> (Nirvana), a state of profound peace, freedom, and the complete cessation of Dukkha.</p>
                    <h2>4. The Truth of the Path to the Cessation of Suffering (Magga)</h2>
                    <p>The fourth and final truth lays out the practical method for ending suffering: The Noble Eightfold Path. This is the prescription for the ailment of Dukkha. By cultivating wisdom, ethical conduct, and mental discipline, we systematically uproot the causes of our dissatisfaction and move towards liberation.</p>
                `
            },
            "noble-eightfold-path": {
                title: "The Noble Eightfold Path: A Practical Guide",
                category: "Core Teachings",
                categoryId: "teachings",
                date: "September 1, 2025",
                readTime: 9,
                author: "Alan Dhamma",
                tags: ["teachings", "eightfold path", "ethics", "meditation"],
                content: `
                    <p>The Noble Eightfold Path is the Buddha's practical prescription for ending suffering. It is not a set of rules, but a group of eight interconnected factors that, when developed together, lead to wisdom, peace, and liberation.</p>
                    <h2>Division 1: Wisdom (<span class="pali-term" data-term="panna">Paññā</span>)</h2>
                    <ol>
                        <li><strong>Right Understanding (Sammā Diṭṭhi):</strong> Seeing things as they truly are, which begins with understanding the Four Noble Truths.</li>
                        <li><strong>Right Intention (Sammā Saṅkappa):</strong> Cultivating intentions of renunciation, goodwill, and harmlessness.</li>
                    </ol>
                    <h2>Division 2: Ethical Conduct (Sīla)</h2>
                    <ol start="3">
                        <li><strong>Right Speech (Sammā Vācā):</strong> Abstaining from lying, divisive speech, harsh speech, and idle chatter.</li>
                        <li><strong>Right Action (Sammā Kammanta):</strong> Abstaining from killing, stealing, and sexual misconduct.</li>
                        <li><strong>Right Livelihood (Sammā Ājīva):</strong> Earning a living in a way that does not harm others.</li>
                    </ol>
                    <h2>Division 3: Mental Discipline (<span class="pali-term" data-term="samadhi">Samādhi</span>)</h2>
                    <ol start="6">
                        <li><strong>Right Effort (Sammā Vāyāma):</strong> Actively preventing unwholesome states and cultivating wholesome ones.</li>
                        <li><strong>Right Mindfulness (Sammā Sati):</strong> Developing bare awareness of the body, feelings, mind, and mental objects.</li>
                        <li><strong>Right Concentration (Sammā Samādhi):</strong> Developing one-pointedness of mind, often through meditation, leading to deep states of calm and insight.</li>
                    </ol>
                    <div class="call-out-box"><p>These eight factors support and strengthen each other. Ethical conduct provides a stable foundation for concentration, which in turn clarifies the mind, allowing wisdom to arise.</p></div>
                `
            },
            "metta-meditation": {
                title: "A Guide to Mettā (Loving-Kindness) Meditation",
                category: "Meditation",
                categoryId: "meditation",
                date: "September 12, 2025",
                readTime: 8,
                author: "Jane Bodhi",
                tags: ["meditation", "metta", "loving-kindness", "compassion"],
                audioSrc: null, // Audio will be generated programmatically
                content: `
                    <p><span class="pali-term" data-term="metta">Mettā</span>, or loving-kindness, is a meditation practice designed to cultivate unconditional, compassionate love for all beings. It is a powerful antidote to anger, ill will, and fear.</p>
                    <h2>The Practice</h2>
                    <p>Find a comfortable sitting position and gently close your eyes. Begin by offering loving-kindness to yourself. Silently repeat phrases that resonate with you, such as:</p>
                    <ul>
                        <li>May I be happy.</li>
                        <li>May I be healthy.</li>
                        <li>May I be safe.</li>
                        <li>May I live with ease.</li>
                    </ul>
                    <p>Feel the intention behind the words. There is no need to force a particular feeling; simply offer the phrases with gentle sincerity.</p>
                    <h2>Expanding the Circle of Kindness</h2>
                    <p>After a few minutes of offering mettā to yourself, you gradually expand the circle of loving-kindness to include others:</p>
                    <ol>
                        <li><strong>A loved one:</strong> Bring to mind a close friend or family member. Offer them the same phrases: "May you be happy. May you be healthy..."</li>
                        <li><strong>A neutral person:</strong> Think of someone you see regularly but don't have strong feelings about, like a cashier or a neighbor. Offer them mettā.</li>
                        <li><strong>A difficult person:</strong> This can be challenging. Bring to mind someone with whom you have friction. To the best of your ability, offer them the same wishes for their happiness and well-being.</li>
                        <li><strong>All beings:</strong> Finally, expand your loving-kindness to all living beings everywhere, without exception. "May all beings be happy. May all beings be healthy..."</li>
                    </ol>
                    <blockquote>"Just as a mother would protect her only child at the risk of her own life, even so, let him cultivate a boundless heart towards all beings."</blockquote>
                `
            }
        },
        categories: {
            "introduction": {
                title: "Introduction to Theravāda",
                description: "Begin your journey here. Understand the origins, history, and foundational principles of the oldest school of Buddhism."
            },
            "teachings": {
                title: "Core Teachings",
                description: "Explore the fundamental doctrines of the Buddha, from the Four Noble Truths to the nature of reality. These articles form the philosophical heart of the path."
            },
            "meditation": {
                title: "Meditation & Practice",
                description: "Learn the practical techniques of mindfulness and concentration. Our guides provide clear, step-by-step instructions to help you establish a stable and fruitful practice."
            }
        },
        glossary: {
            "theravada": "The 'Way of the Elders'. The oldest surviving school of Buddhism, based on the Pāli Canon.",
            "dukkha": "Unsatisfactoriness, suffering, stress. The inherent unease in conditioned existence.",
            "anicca": "Impermanence. The principle that all conditioned things are in a constant state of flux.",
            "anatta": "Not-self. The doctrine that there is no permanent, unchanging soul or self.",
            "nibbana": "Nirvana. The ultimate goal, meaning 'to extinguish'. The cessation of suffering and the cycle of rebirth.",
            "panna": "Wisdom, insight. One of the three divisions of the Noble Eightfold Path.",
            "samadhi": "Concentration, mental discipline. The second division of the Noble Eightfold Path.",
            "vipassana": "Insight meditation. The practice of seeing things as they truly are.",
            "anapanasati": "Mindfulness of breathing. A core meditation practice.",
            "metta": "Loving-kindness, goodwill. A meditation practice for cultivating universal, non-attached love."
        },
        authors: {
            "Alan Dhamma": {
                name: "Alan Dhamma",
                bio: "Alan is the founder of The Dhamma Path and a long-term practitioner of Vipassanā meditation in the Theravāda tradition. His focus is on making the original teachings accessible and practical for modern life.",
                avatar: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHZpZXdCb3g9IjAgMCA4MCA4MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iNDAiIGN5PSI0MCIgcj0iNDAiIGZpbGw9IiM2Yjg1NzYiLz4KPGNpcmNsZSBjeD0iNDAiIGN5PSIzMCIgcj0iMTIiIGZpbGw9IiNGREZCRjUiLz4KPHBhdGggZD0iTTI1IDY1QzI1IDU1IDMxIDQ1IDQwIDQ1UzU1IDU1IDU1IDY1VjY1SDI1WiIgZmlsbD0iI0ZERkJGNSIvPgo8L3N2Zz4K"
            },
            "Jane Bodhi": {
                name: "Jane Bodhi",
                bio: "Jane has been a dedicated student of Buddhist meditation for over 15 years. She is a certified mindfulness instructor and is passionate about sharing the benefits of practice with others.",
                 avatar: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHZpZXdCb3g9IjAgMCA4MCA4MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iNDAiIGN5PSI0MCIgcj0iNDAiIGZpbGw9IiNjOWE5NzMiLz4KPGNpcmNsZSBjeD0iNDAiIGN5PSIzMCIgcj0iMTIiIGZpbGw9IiNGREZCRjUiLz4KPHBhdGggZD0iTTI1IDY1QzI1IDU1IDMxIDQ1IDQwIDQ1UzU1IDU1IDU1IDY1VjY1SDI1WiIgZmlsbD0iI0ZERkJGNSIvPgo8L3N2Zz4K"
            }
        },
        paths: {
            "7-day-mindfulness": {
                title: "7-Day Introduction to Mindfulness",
                description: "A guided path for beginners to establish a daily practice. Each day includes a short reading and a guided meditation.",
                steps: [
                    { day: 1, title: "Finding Your Seat & Your Breath", articleId: "vipassana-guide", focus: "Posture and basic breath awareness."},
                    { day: 2, title: "Working with a Wandering Mind", articleId: "vipassana-guide", focus: "Gently returning your attention without judgment."},
                    { day: 3, title: "Mindfulness of the Body", articleId: "vipassana-guide", focus: "Expanding awareness to physical sensations."},
                    { day: 4, title: "Cultivating Loving-Kindness", articleId: "metta-meditation", focus: "Introducing the practice of Mettā."},
                    { day: 5, title: "Observing Thoughts and Feelings", articleId: "vipassana-guide", focus: "Seeing mental events as impermanent."},
                    { day: 6, title: "Mindfulness in Daily Life", articleId: "what-is-theravada", focus: "Taking practice off the cushion."},
                    { day: 7, title: "Establishing a Routine", articleId: "noble-eightfold-path", focus: "Tips for continuing your practice."}
                ]
            }
        },
        workout: {
            exercises: [
                { name: "Jumping Jacks", duration: 30, calories: 8, instructions: "Stand with feet together and arms at your sides. Jump up spreading your feet shoulder-width apart while bringing your arms overhead. Jump back to starting position.", visual: '<svg viewBox="0 0 100 100" class="w-full h-full"><g stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" fill="none"><circle cx="50" cy="25" r="6" fill="currentColor" opacity="0.8"/><path d="M50 35v25m0 0l-12 25m12-25l12 25M50 45L35 30m30 0L65 30"><animateTransform attributeName="transform" type="translate" values="0 0; 0 8; 0 0" dur="0.8s" repeatCount="indefinite"/></path><path d="M35 75L25 90m30-30l-10-15m30 30l10-15"><animateTransform attributeName="transform" type="translate" values="0 0; 0 -8; 0 0" dur="0.8s" repeatCount="indefinite"/></path><circle cx="20" cy="85" r="3" fill="currentColor" opacity="0.6"><animateTransform attributeName="transform" type="translate" values="0 0; 0 -5; 0 0" dur="0.8s" repeatCount="indefinite"/></circle><circle cx="80" cy="85" r="3" fill="currentColor" opacity="0.6"><animateTransform attributeName="transform" type="translate" values="0 0; 0 -5; 0 0" dur="0.8s" repeatCount="indefinite"/></circle></g></svg>' },
                { name: "Wall Sit", duration: 30, visual: '<svg viewBox="0 0 100 100"><g stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" fill="none"><path d="M30 10v80"/><circle cx="50" cy="35" r="5"/><path d="M50 40v20 H40 v20 H50 v10"/><path d="M50 60 L60 60"><animate attributeName="d" values="M50 60 L60 60; M50 60 L65 60; M50 60 L60 60" dur="2s" repeatCount="indefinite"/></path></g></svg>' },
                { name: "Push-ups", duration: 30, visual: '<svg viewBox="0 0 100 100" class="w-full h-full"><g stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" fill="none"><rect x="10" y="75" width="80" height="8" fill="currentColor" opacity="0.3"/><path d="M25 75 L50 35 L75 75"><animate attributeName="d" values="M25 75 L50 35 L75 75; M25 75 L50 55 L75 75; M25 75 L50 35 L75 75" dur="1.2s" repeatCount="indefinite"/></path><circle cx="50" cy="35" r="4" fill="currentColor" opacity="0.8"><animateTransform attributeName="transform" type="translate" values="0 0; 0 20; 0 0" dur="1.2s" repeatCount="indefinite"/></circle><path d="M45 30 L50 25 L55 30" stroke-width="2"><animateTransform attributeName="transform" type="translate" values="0 0; 0 20; 0 0" dur="1.2s" repeatCount="indefinite"/></path></g></svg>' },
                { name: "Crunches", duration: 30, visual: '<svg viewBox="0 0 100 100"><g stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" fill="none"><path d="M20 80 L40 60 H80 L90 80"/><path d="M45 60 L35 40 m 30 0 L75 40"><animateTransform attributeName="transform" type="translate" values="0 0; 0 5; 0 0" dur="1s" repeatCount="indefinite"/></path><circle cx="55" cy="30" r="5"><animateTransform attributeName="transform" type="translate" values="0 0; 0 5; 0 0" dur="1s" repeatCount="indefinite"/></circle></g></svg>' },
                { name: "Step-ups", duration: 30, visual: '<svg viewBox="0 0 100 100"><g stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" fill="none"><path d="M20 80H80v10H20z"/><circle cx="40" cy="30" r="5"/><path d="M40 35v35H30v10"><animate attributeName="d" values="M40 35v35H30v10; M60 35v35H50v10; M40 35v35H30v10" dur="1.5s" repeatCount="indefinite"/></path></g></svg>' },
                { name: "Squats", duration: 30, visual: '<svg viewBox="0 0 100 100" class="w-full h-full"><g stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" fill="none"><circle cx="50" cy="25" r="6" fill="currentColor" opacity="0.8"/><path d="M50 35v30m0 0L40 90m10-25L60 90"><animateTransform attributeName="transform" type="translate" values="0 0; 0 15; 0 0" dur="1.5s" repeatCount="indefinite"/></path><path d="M45 30 L50 25 L55 30" stroke-width="2"><animateTransform attributeName="transform" type="translate" values="0 0; 0 15; 0 0" dur="1.5s" repeatCount="indefinite"/></path><circle cx="35" cy="85" r="4" fill="currentColor" opacity="0.6"><animateTransform attributeName="transform" type="translate" values="0 0; 0 15; 0 0" dur="1.5s" repeatCount="indefinite"/></circle><circle cx="65" cy="85" r="4" fill="currentColor" opacity="0.6"><animateTransform attributeName="transform" type="translate" values="0 0; 0 15; 0 0" dur="1.5s" repeatCount="indefinite"/></circle></g></svg>' },
                { name: "Triceps Dips", duration: 30, visual: '<svg viewBox="0 0 100 100"><g stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" fill="none"><path d="M20 60h60v10H20z"/><g><circle cx="50" cy="30" r="5"/><path d="M50 35v15m-15-15l15 15l15-15"/><animateTransform attributeName="transform" type="translate" values="0 0; 0 10; 0 0" dur="1s" repeatCount="indefinite"/></g></g></svg>' },
                { name: "Plank", duration: 30, visual: '<svg viewBox="0 0 100 100"><g stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" fill="none"><path d="M10 70L30 50 H70 L90 70"/><path d="M30 50v20m40-20v20"><animateTransform attributeName="transform" type="translate" values="0 0; 0 2; 0 0" dur="2s" repeatCount="indefinite"/></path></g></svg>' },
                { name: "High Knees", duration: 30, visual: '<svg viewBox="0 0 100 100"><g stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" fill="none"><circle cx="50" cy="30" r="5"/><path d="M50 35v25m0 0L40 85m10-25L60 85"/><path d="M40 85v-20h-5"><animate attributeName="d" values="M40 85v-20h-5; M40 65v-20h-5; M40 85v-20h-5" dur="0.5s" repeatCount="indefinite"/></path><path d="M60 65v20h5"><animate attributeName="d" values="M60 65v20h5; M60 85v-20h5; M60 65v20h5" dur="0.5s" repeatCount="indefinite"/></path></g></svg>' },
                { name: "Lunges", duration: 30, visual: '<svg viewBox="0 0 100 100"><g stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" fill="none"><circle cx="50" cy="30" r="5"/><path d="M50 35v25L70 85"/><path d="M50 60L30 85"><animate attributeName="d" values="M50 60L30 85; M50 60L50 85; M50 60L30 85" dur="1s" repeatCount="indefinite" alternate="true"/></path></g></svg>' },
                { name: "Push-up & Rotation", duration: 30, visual: '<svg viewBox="0 0 100 100"><g stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" fill="none"><path d="M10 80h80"/><path d="M20 80 L50 40 L80 80"/><path d="M50 40v-15"><animateTransform attributeName="transform" type="rotate" values="0 50 40; 90 50 40; 0 50 40" dur="2s" repeatCount="indefinite"/></path></g></svg>' },
                { name: "Side Plank", duration: 30, visual: '<svg viewBox="0 0 100 100"><g stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" fill="none"><path d="M50 10v80"/><path d="M50 50l30-20v40z"/><circle cx="80" cy="30" r="5"><animateTransform attributeName="transform" type="translate" values="0 0; 0 2; 0 0" dur="2s" repeatCount="indefinite"/></path></g></svg>' }
            ],
            restDuration: 10
        },
        interviewQuestions: {
            general: [
                "Tell me about yourself.",
                "What are your goals for today?",
                "How do you like to start your mornings?",
                "What motivates you to get up each day?",
                "Describe your ideal morning routine.",
                "What's something you're looking forward to this week?",
                "How do you stay focused throughout the day?",
                "What's a recent accomplishment you're proud of?"
            ],
            behavioral: [
                "Tell me about a time you had to adapt to a difficult situation.",
                "Describe a time you helped someone solve a problem.",
                "Tell me about a time you had to learn something new quickly.",
                "How do you handle unexpected challenges?",
                "Give an example of when you had to work with a difficult person.",
                "Describe a time you had to make a tough decision.",
                "Tell me about a time you failed and what you learned from it.",
                "How do you stay motivated when things get tough?"
            ],
            presentation: [
                "Present your morning routine to a friend.",
                "Explain why meditation is important for daily life.",
                "Describe your ideal work environment.",
                "Present three ways to stay productive throughout the day.",
                "Explain the benefits of a healthy morning routine.",
                "Describe how you would teach someone to be more confident.",
                "Present your vision for personal growth this year.",
                "Explain why self-care is essential for success."
            ]
        }
    };

    // --- APP LOGIC --- //
    document.addEventListener('DOMContentLoaded', () => {
        const mainContent = document.getElementById('main-content');
        
        // --- Dark Mode --- //
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const darkModeToggleMobile = document.getElementById('dark-mode-toggle-mobile');
        const sunIcon = document.getElementById('sun-icon');
        const moonIcon = document.getElementById('moon-icon');
        
        const applyTheme = (isDark) => {
            if (isDark) {
                document.documentElement.classList.add('dark');
                sunIcon.style.display = 'none';
                moonIcon.style.display = 'block';
            } else {
                document.documentElement.classList.remove('dark');
                sunIcon.style.display = 'block';
                moonIcon.style.display = 'none';
            }
        };

        const toggleDarkMode = () => {
            const isDark = !document.documentElement.classList.contains('dark');
            localStorage.setItem('darkMode', isDark);
            applyTheme(isDark);
        };

        darkModeToggle.addEventListener('click', toggleDarkMode);
        darkModeToggleMobile.addEventListener('click', toggleDarkMode);

        // Check for saved preference
        if (localStorage.getItem('darkMode') === 'true' || 
           (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches && !localStorage.getItem('darkMode'))) {
            applyTheme(true);
        } else {
            applyTheme(false);
        }

        // --- Mobile Menu --- //
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // --- Scroll Progress Bar --- //
        const progressBar = document.getElementById('progress-bar');
        const updateProgressBar = () => {
            const { scrollTop, scrollHeight, clientHeight } = document.documentElement;
            if (scrollHeight > clientHeight) {
                const scrollPercent = (scrollTop / (scrollHeight - clientHeight)) * 100;
                progressBar.style.width = `${scrollPercent}%`;
            } else {
                progressBar.style.width = '0%';
            }
        };
        window.addEventListener('scroll', updateProgressBar);
        
        // --- Templating & Routing --- //
        const templates = {
            home: document.getElementById('template-home').content.cloneNode(true),
            category: document.getElementById('template-category').content.cloneNode(true),
            article: document.getElementById('template-article').content.cloneNode(true),
            about: document.getElementById('template-about').content.cloneNode(true),
            glossary: document.getElementById('template-glossary').content.cloneNode(true),
            searchResults: document.getElementById('template-search-results').content.cloneNode(true),
            timer: document.getElementById('template-timer').content.cloneNode(true),
            path: document.getElementById('template-path').content.cloneNode(true),
            workout: document.getElementById('template-workout').content.cloneNode(true),
            interview: document.getElementById('template-interview').content.cloneNode(true),
            journal: document.getElementById('template-journal').content.cloneNode(true),
        };

        const renderArticleCard = (articleId, article, fullWidth = false, delay = 0) => {
            const description = article.content.match(/<p>(.*?)<\/p>/)[1].replace(/<[^>]+>/g, '').substring(0, 100);
            return `
                <a href="#" data-page="article" data-article-id="${articleId}" class="main-nav-link card-link group block ${fullWidth ? '' : 'p-6 bg-light-green rounded-lg shadow-sm border border-black/5'}" style="animation-delay: ${delay}s">
                    <div class="space-y-2">
                         <p class="text-sm font-semibold uppercase tracking-wider text-earthy-gold">${article.category}</p>
                         <h3 class="text-2xl font-bold text-charcoal font-lora group-hover:text-forest-green transition-colors">${article.title}</h3>
                         <p class="text-charcoal/70">${description}...</p>
                         <span class="text-sm text-forest-green font-semibold">Read more &rarr;</span>
                    </div>
                </a>
            `;
        };
        
        const renderHomePage = () => {
            const page = templates.home.cloneNode(true);
            const latestArticlesGrid = page.getElementById('latest-articles-grid');
            
            // Add stagger animation to cards
            Object.entries(db.articles).slice(0, 4).forEach(([id, article], index) => {
                const card = document.createElement('div');
                card.className = 'stagger-in';
                card.style.animationDelay = `${index * 0.1}s`;
                card.innerHTML = renderArticleCard(id, article, true, index * 0.1);
                latestArticlesGrid.appendChild(card);
            });
            
            // Show quick access toolbar on home page
            document.getElementById('quick-access').classList.remove('hidden');
            
            return page;
        };
        
        const renderAboutPage = () => {
            const page = templates.about.cloneNode(true);
            // Add stagger animation to header
            const header = page.querySelector('header');
            if (header) {
                header.className += ' stagger-in';
            }
            return page;
        };

        const renderGlossaryPage = () => {
            const page = templates.glossary.cloneNode(true);
            const list = page.getElementById('glossary-list');
            
            // Add stagger animation to header
            const header = page.querySelector('header');
            if (header) {
                header.className += ' stagger-in';
            }
            
            Object.entries(db.glossary).sort().forEach(([term, def], index) => {
                const item = document.createElement('div');
                item.className = 'p-6 bg-light-green rounded-lg stagger-in';
                item.style.animationDelay = `${index * 0.05}s`;
                item.innerHTML = `
                    <h3 class="text-2xl font-bold text-forest-green font-lora">${term.charAt(0).toUpperCase() + term.slice(1)}</h3>
                    <p class="mt-2 text-charcoal/80">${def}</p>
                `;
                list.appendChild(item);
            });
            return page;
        };

        const renderCategoryPage = (categoryId) => {
            const page = templates.category.cloneNode(true);
            const category = db.categories[categoryId];
            if (!category) return renderHomePage();

            page.getElementById('category-title').textContent = category.title;
            page.getElementById('category-description').textContent = category.description;
            const grid = page.getElementById('category-articles-grid');
            
            // Add stagger animation to category header
            const header = page.querySelector('header');
            if (header) {
                header.className += ' stagger-in';
            }
            
            // Add paths section if it's the meditation category
            if (categoryId === 'meditation') {
                const pathsSection = page.getElementById('category-paths-section');
                let pathsHtml = '<h2 class="text-3xl font-bold text-center text-charcoal font-lora mb-10">Guided Paths</h2><div class="grid grid-cols-1 md:grid-cols-2 gap-8 stagger-in">';
                Object.entries(db.paths).forEach(([id, path], index) => {
                    pathsHtml += `
                    <a href="#" data-page="path" data-path-id="${id}" class="main-nav-link card-link block p-8 bg-light-gold rounded-lg shadow-sm duration-300 border border-black/5" style="animation-delay: ${index * 0.1}s">
                        <h3 class="text-2xl font-bold text-earthy-gold font-lora">${path.title}</h3>
                        <p class="mt-2 text-charcoal/80">${path.description}</p>
                    </a>
                    `;
                });
                pathsHtml += '</div><hr class="my-16 border-gray-300/70 dark:border-gray-600">';
                pathsSection.innerHTML = pathsHtml;
            }

            Object.entries(db.articles)
                .filter(([id, article]) => article.categoryId === categoryId)
                .forEach(([id, article], index) => {
                    const card = document.createElement('div');
                    card.className = 'stagger-in';
                    card.style.animationDelay = `${index * 0.1}s`;
                    card.innerHTML = renderArticleCard(id, article, false, index * 0.1);
                    grid.appendChild(card);
                });
            return page;
        };
        
        const renderArticlePage = (articleId) => {
            const page = templates.article.cloneNode(true);
            const article = db.articles[articleId];
            if (!article) return renderHomePage();

            const categoryLink = page.getElementById('article-category-link');
            categoryLink.textContent = article.category;
            categoryLink.dataset.page = `category-${article.categoryId}`;

            page.getElementById('article-title').textContent = article.title;
            page.getElementById('article-date').textContent = article.date;
            page.getElementById('article-read-time').textContent = article.readTime;
            const articleContentDiv = page.getElementById('article-content');
            articleContentDiv.innerHTML = article.content;

            // Audio Player
            if (article.audioSrc) {
                const audioPlayerContainer = page.getElementById('audio-player-container');
                audioPlayerContainer.innerHTML = `
                    <div class="bg-light-green p-6 rounded-lg">
                         <h3 class="text-xl font-bold font-lora text-forest-green mb-4">Guided Meditation</h3>
                         <div class="flex items-center space-x-4">
                            <button class="audio-play-btn w-14 h-14 bg-forest-green text-white rounded-full flex items-center justify-center hover:bg-forest-green/90 transition">
                                <svg class="play-icon h-8 w-8" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" /></svg>
                                <svg class="pause-icon h-8 w-8 hidden" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                            </button>
                            <div class="flex-grow">
                                <p class="font-semibold text-charcoal">${article.readTime}-Minute Guided Practice</p>
                                <div class="relative pt-1">
                                    <div class="overflow-hidden h-2 mt-2 text-xs flex rounded bg-gray-300">
                                        <div style="width:0%" class="audio-progress shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-earthy-gold"></div>
                                    </div>
                                </div>
                            </div>
                         </div>
                    </div>
                `;
            }

            // Generate TOC
            const tocList = page.getElementById('toc-list');
            const headings = articleContentDiv.querySelectorAll('h2');
            if(headings.length > 0){
                headings.forEach(h => {
                    const id = h.textContent.toLowerCase().replace(/\s+/g, '-').replace(/[^\w-]+/g, '');
                    h.id = id;
                    const li = document.createElement('li');
                    li.innerHTML = `<a href="#${id}" class="hover:text-forest-green">${h.textContent}</a>`;
                    tocList.appendChild(li);
                });
            } else {
                page.getElementById('article-toc').style.display = 'none';
            }

            // Author Bio
            const author = db.authors[article.author];
            if (author) {
                const authorBioDiv = page.getElementById('author-bio');
                authorBioDiv.innerHTML = `
                    <img src="${author.avatar}" alt="${author.name}" class="w-20 h-20 rounded-full">
                    <div>
                        <p class="text-sm text-charcoal/70 uppercase tracking-wider">Written by</p>
                        <h4 class="text-xl font-bold font-lora text-charcoal">${author.name}</h4>
                        <p class="mt-1 text-charcoal/80">${author.bio}</p>
                    </div>
                `;
            }

            // Related Articles
            const relatedArticlesDiv = page.getElementById('related-articles');
            const relatedArticles = Object.entries(db.articles)
                .filter(([id, a]) => id !== articleId && (a.categoryId === article.categoryId || a.tags.some(t => article.tags.includes(t))))
                .slice(0, 3);
            
            if (relatedArticles.length > 0) {
                relatedArticlesDiv.innerHTML = `<h3 class="text-3xl font-bold font-lora text-center mb-8">Related Articles</h3>`;
                const grid = document.createElement('div');
                grid.className = 'grid grid-cols-1 md:grid-cols-3 gap-8 stagger-in';
                relatedArticles.forEach(([id, a], index) => {
                    const card = document.createElement('div');
                    card.innerHTML = renderArticleCard(id, a, false, index * 0.1);
                    grid.appendChild(card);
                });
                relatedArticlesDiv.appendChild(grid);
            }

            // Comments
            const commentsDiv = page.getElementById('comments-section');
            commentsDiv.innerHTML = `
                <h3 class="text-3xl font-bold font-lora mb-6">Leave a Comment</h3>
                <form class="space-y-4">
                    <textarea placeholder="Your comment..." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-earthy-gold focus:outline-none dark:bg-gray-700 dark:border-gray-600" rows="4"></textarea>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="text" placeholder="Your Name" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-earthy-gold focus:outline-none dark:bg-gray-700 dark:border-gray-600">
                        <input type="email" placeholder="Your Email (not published)" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-earthy-gold focus:outline-none dark:bg-gray-700 dark:border-gray-600">
                    </div>
                    <button type="submit" class="px-6 py-3 bg-forest-green text-white font-semibold rounded-lg hover:bg-forest-green/90 transition">Post Comment</button>
                </form>
                <div class="mt-12 space-y-8">
                    <h4 class="text-2xl font-bold font-lora">2 Comments</h4>
                    <div class="flex space-x-4">
                        <div class="w-12 h-12 rounded-full bg-earthy-gold flex items-center justify-center text-white font-bold text-lg">M</div>
                        <div>
                            <p class="font-bold text-charcoal">Maria S.</p>
                            <p class="text-sm text-charcoal/60 mb-2">September 9, 2025</p>
                            <p class="text-charcoal/90">Thank you for this wonderful guide. The instructions for mindfulness of breath are the clearest I've ever read.</p>
                        </div>
                    </div>
                    <div class="flex space-x-4">
                        <div class="w-12 h-12 rounded-full bg-light-green flex items-center justify-center text-forest-green font-bold text-lg">D</div>
                        <div>
                            <p class="font-bold text-charcoal">David L.</p>
                            <p class="text-sm text-charcoal/60 mb-2">September 11, 2025</p>
                            <p class="text-charcoal/90">Really appreciate the breakdown of the body scan. It's a part of the practice I've always struggled with.</p>
                        </div>
                    </div>
                </div>
            `;
            return page;
        };
        
        const renderSearchResultsPage = (query) => {
            const page = templates.searchResults.cloneNode(true);
            const resultsList = page.getElementById('search-results-list');
            const queryText = page.getElementById('search-results-query');

            // Add stagger animation to header
            const header = page.querySelector('header');
            if (header) {
                header.className += ' stagger-in';
            }

            const lowerQuery = query.toLowerCase();
            const results = Object.entries(db.articles).filter(([id, article]) => {
                return article.title.toLowerCase().includes(lowerQuery) || article.content.toLowerCase().includes(lowerQuery);
            });

            if (results.length > 0) {
                queryText.textContent = `Found ${results.length} result(s) for "${query}"`;
                results.forEach(([id, article], index) => {
                     const card = document.createElement('div');
                     card.className = 'border-b border-gray-200 dark:border-gray-700 pb-6 stagger-in';
                     card.style.animationDelay = `${index * 0.1}s`;
                     card.innerHTML = renderArticleCard(id, article, true);
                     resultsList.appendChild(card);
                });
            } else {
                queryText.textContent = `No results found for "${query}"`;
            }
            return page;
        };
        
        const renderTimerPage = () => {
            const page = templates.timer.cloneNode(true);
            // Add stagger animation to header
            const header = page.querySelector('header');
            if (header) {
                header.className += ' stagger-in';
            }
            return page;
        };
        
        const renderWorkoutPage = () => {
            const page = templates.workout.cloneNode(true);
            // Add stagger animation to header
            const header = page.querySelector('header');
            if (header) {
                header.className += ' stagger-in';
            }
            return page;
        };
        
        const renderInterviewPage = () => {
            const page = templates.interview.cloneNode(true);
            // Add stagger animation to header
            const header = page.querySelector('header');
            if (header) {
                header.className += ' stagger-in';
            }
            return page;
        };
        
        const renderJournalPage = () => {
            const page = templates.journal.cloneNode(true);
            // Add stagger animation to header
            const header = page.querySelector('header');
            if (header) {
                header.className += ' stagger-in';
            }
            return page;
        };

        const renderPathPage = (pathId) => {
            const page = templates.path.cloneNode(true);
            const path = db.paths[pathId];
            if (!path) return renderHomePage();

            // Add stagger animation to header
            const header = page.querySelector('header');
            if (header) {
                header.className += ' stagger-in';
            }

            page.getElementById('path-title').textContent = path.title;
            page.getElementById('path-description').textContent = path.description;
            const list = page.getElementById('path-steps-list');
            path.steps.forEach((step, index) => {
                const item = document.createElement('a');
                item.href = '#';
                item.dataset.page = 'article';
                item.dataset.articleId = step.articleId;
                item.className = 'main-nav-link card-link block p-6 bg-light-green rounded-lg shadow-sm hover:shadow-md transition-shadow flex items-center space-x-6 stagger-in';
                item.style.animationDelay = `${index * 0.1}s`;
                item.innerHTML = `
                    <div class="flex-shrink-0 w-12 h-12 flex items-center justify-center bg-forest-green text-white rounded-full font-lora text-2xl">${step.day}</div>
                    <div>
                        <h3 class="text-xl font-bold text-charcoal font-lora">${step.title}</h3>
                        <p class="text-charcoal/80">Focus: ${step.focus}</p>
                    </div>
                    <div class="ml-auto text-forest-green">&rarr;</div>
                `;
                list.appendChild(item);
            });
            return page;
        };
        
        let timerInterval = null;
        let workoutInterval = null;
        let journalInterval = null;
        let mediaRecorder = null;
        let recordedChunks = [];
        let sessionRecordings = [];

        const sounds = {
            chime: new Audio("data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YV8vT19IA38JfweLCPsI/wklDSAKNA04DhsPMg8ADBwPGA8kEI4Q8xAhEWgSChPWFBoU4BUkFWQWahd6F4EX7xgdGG4YzxkPG8wbKBwSHRseHR8ZICQjJCwmKSgqKiwqLCoqKCQjICAfIBwYGRUQEg8ODAsJCAgHBwUEAwIBAD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8A"),
            bowl: new Audio("data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAIARKwAABCxAgAEABAAZGF0YQAAAAA="),
            wood: new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=")
        };
        
        const showLoading = () => {
            document.getElementById('loading-indicator').classList.remove('hidden');
        };
        
        const hideLoading = () => {
            document.getElementById('loading-indicator').classList.add('hidden');
        };

        const showNotification = (message) => {
            const notification = document.getElementById('notification');
            const text = document.getElementById('notification-text');
            text.textContent = message;
            notification.classList.remove('translate-x-full');
            setTimeout(() => {
                notification.classList.add('translate-x-full');
            }, 3000);
        };

        const navigateTo = (pageName, id = null) => {
            // Show loading for non-instant transitions
            if (pageName !== 'home') {
                showLoading();
            }
            
            // Hide quick access toolbar on non-home pages
            if (pageName !== 'home') {
                document.getElementById('quick-access').classList.add('hidden');
            }
            
            clearInterval(timerInterval); 
            clearInterval(workoutInterval);
            clearInterval(journalInterval);
            document.body.classList.remove('fullscreen-active', 'journal-focus');
            if (mediaRecorder && mediaRecorder.state === "recording") {
                mediaRecorder.stop();
            }
            if(window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
            }
            mainContent.innerHTML = '';
            let pageContent;

            switch(pageName) {
                case 'category-introduction': pageContent = renderCategoryPage('introduction'); break;
                case 'category-teachings': pageContent = renderCategoryPage('teachings'); break;
                case 'category-meditation': pageContent = renderCategoryPage('meditation'); break;
                case 'article': pageContent = renderArticlePage(id); break;
                case 'about': pageContent = renderAboutPage(); break;
                case 'glossary': pageContent = renderGlossaryPage(); break;
                case 'searchResults': pageContent = renderSearchResultsPage(id); break;
                case 'timer': pageContent = renderTimerPage(); break;
                case 'path': pageContent = renderPathPage(id); break;
                case 'workout': pageContent = renderWorkoutPage(); break;
                case 'interview': pageContent = renderInterviewPage(); break;
                case 'journal': pageContent = renderJournalPage(); break;
                case 'home': default: pageContent = renderHomePage();
            }
            
            mainContent.appendChild(pageContent);
            
            // Hide loading indicator after content is rendered
            setTimeout(() => {
                hideLoading();
            }, 100);

            if (pageName === 'timer') attachTimerLogic();
            if (pageName === 'article') attachArticlePageLogic(id);
            if (pageName === 'workout') attachWorkoutLogic();
            if (pageName === 'interview') attachInterviewLogic();
            if (pageName === 'journal') attachJournalLogic();

            mainContent.classList.add('fade-in');
            setTimeout(() => mainContent.classList.remove('fade-in'), 500);
            window.scrollTo(0, 0);
            mobileMenu.classList.add('hidden'); // Close mobile menu on nav
            updateProgressBar(); // Recalculate progress for new page
            updateActiveNavLink(pageName);
        };
        
        function updateActiveNavLink(currentPage) {
            document.querySelectorAll('#desktop-nav-links a, #mobile-nav-links a').forEach(link => {
                const linkPage = link.dataset.page;
                // Handle category pages as a special case
                const isActive = (linkPage === currentPage) || 
                               (linkPage.startsWith('category-') && currentPage === linkPage) ||
                               (currentPage.startsWith('path') && linkPage === 'category-meditation');

                if (isActive) {
                     link.classList.add('active');
                } else {
                     link.classList.remove('active');
                }
            });
        }
        
        // --- Onboarding Logic --- //
        const onboardingModal = document.getElementById('onboarding-modal');
        if (!localStorage.getItem('dhammaPathVisited')) {
            onboardingModal.classList.remove('hidden');
        }
        onboardingModal.addEventListener('click', (e) => {
            if (e.target.closest('.onboarding-choice') || e.target.id === 'close-onboarding') {
                onboardingModal.classList.add('hidden');
                localStorage.setItem('dhammaPathVisited', 'true');
            }
        });

        // Initial page load
        navigateTo('home');

        // Navigation event listener
        document.body.addEventListener('click', (e) => {
            const link = e.target.closest('.main-nav-link');
            if (link) {
                e.preventDefault();
                const page = link.dataset.page;
                const id = link.dataset.articleId || link.dataset.pathId;
                navigateTo(page, id);
            }
        });
        
        // --- Keyboard Shortcuts --- //
        document.addEventListener('keydown', (e) => {
            // Only trigger if not typing in input fields
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
            
            switch(e.key) {
                case 'h':
                case 'H':
                    if (e.ctrlKey || e.metaKey) {
                        e.preventDefault();
                        navigateTo('home');
                    }
                    break;
                case 't':
                case 'T':
                    if (e.ctrlKey || e.metaKey) {
                        e.preventDefault();
                        navigateTo('timer');
                    }
                    break;
                case 'j':
                case 'J':
                    if (e.ctrlKey || e.metaKey) {
                        e.preventDefault();
                        navigateTo('journal');
                    }
                    break;
                case '/':
                    e.preventDefault();
                    document.getElementById('search-input').focus();
                    break;
                case 'Escape':
                    document.getElementById('search-input').blur();
                    document.getElementById('autocomplete-results').classList.add('hidden');
                    break;
            }
        });

        // --- Search with Autocomplete --- //
        const searchInput = document.getElementById('search-input');
        const autocompleteResults = document.getElementById('autocomplete-results');
        
        searchInput.addEventListener('keyup', (e) => {
            const query = searchInput.value.toLowerCase();
            if (e.key === 'Enter' && query.trim() !== '') {
                navigateTo('searchResults', query.trim());
                autocompleteResults.classList.add('hidden');
                searchInput.blur();
                return;
            }

            if (query.length < 2) {
                autocompleteResults.classList.add('hidden');
                return;
            }

            const results = Object.entries(db.articles)
                .filter(([id, article]) => article.title.toLowerCase().includes(query))
                .slice(0, 5);

            if (results.length > 0) {
                autocompleteResults.innerHTML = results.map(([id, article]) => 
                    `<a href="#" data-page="article" data-article-id="${id}" class="main-nav-link block px-4 py-2 hover:bg-light-green dark:hover:bg-gray-700">${article.title}</a>`
                ).join('');
                autocompleteResults.classList.remove('hidden');
            } else {
                autocompleteResults.classList.add('hidden');
            }
        });

        document.addEventListener('click', (e) => {
            if (!searchInput.contains(e.target)) {
                autocompleteResults.classList.add('hidden');
            }
        });


        // Pāli Term Tooltips
        mainContent.addEventListener('mouseover', (e) => {
            if (e.target.classList.contains('pali-term')) {
                const term = e.target.dataset.term;
                const definition = db.glossary[term];
                if (definition && !e.target.querySelector('.pali-tooltip')) {
                    const tooltip = document.createElement('span');
                    tooltip.className = 'pali-tooltip';
                    tooltip.textContent = definition;
                    e.target.appendChild(tooltip);
                }
            }
        });
        
        function attachArticlePageLogic(articleId) {
             // Attach audio player if it exists
            const player = mainContent.querySelector('#audio-player-container');
            if (player) {
                attachAudioPlayerLogic();
            }
            
            // Attach read-aloud logic
            const readAloudBtn = document.getElementById('read-aloud-btn');
            readAloudBtn.addEventListener('click', () => {
                const articleContent = document.getElementById('article-content');
                const text = articleContent.innerText;
                if(speechSynthesis.speaking) {
                    speechSynthesis.cancel();
                    readAloudBtn.querySelector('span').textContent = 'Read Aloud';
                } else {
                    const utterance = new SpeechSynthesisUtterance(text);
                    speechSynthesis.speak(utterance);
                    readAloudBtn.querySelector('span').textContent = 'Stop Reading';
                    utterance.onend = () => {
                        readAloudBtn.querySelector('span').textContent = 'Read Aloud';
                    };
                }
            });
        }
        
        function attachAudioPlayerLogic() {
            const player = mainContent.querySelector('#audio-player-container');
            if (!player) return;

            const playBtn = player.querySelector('.audio-play-btn');
            const playIcon = player.querySelector('.play-icon');
            const pauseIcon = player.querySelector('.pause-icon');
            const progress = player.querySelector('.audio-progress');
            
            let isPlaying = false;
            let progressInterval;

            playBtn.addEventListener('click', () => {
                isPlaying = !isPlaying;
                if(isPlaying) {
                    playIcon.classList.add('hidden');
                    pauseIcon.classList.remove('hidden');
                    let width = 0;
                    progressInterval = setInterval(() => {
                        width += 1;
                        progress.style.width = `${width}%`;
                        if (width >= 100) {
                            clearInterval(progressInterval);
                            playIcon.classList.remove('hidden');
                            pauseIcon.classList.add('hidden');
                        }
                    }, 1000); // Fakes 100 second audio
                } else {
                    playIcon.classList.remove('hidden');
                    pauseIcon.classList.add('hidden');
                    clearInterval(progressInterval);
                }
            });
        }
        
        function attachTimerLogic() {
            const display = document.getElementById('timer-display');
            const ringContainer = document.getElementById('timer-ring-container');
            const progressRing = document.getElementById('timer-progress-ring');
            const startBtn = document.getElementById('timer-start-btn');
            const pauseBtn = document.getElementById('timer-pause-btn');
            const resetBtn = document.getElementById('timer-reset-btn');
            const durationButtons = document.getElementById('duration-buttons');
            const soundSelect = document.getElementById('sound-select');

            let totalSeconds = 600; // default 10 mins
            let secondsRemaining = totalSeconds;
            let isPaused = true;
            const ringCircumference = 2 * Math.PI * 45; // 2 * PI * r
            
            function updateDisplay() {
                const minutes = Math.floor(secondsRemaining / 60);
                const seconds = secondsRemaining % 60;
                display.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                const offset = ringCircumference - (secondsRemaining / totalSeconds) * ringCircumference;
                progressRing.style.strokeDashoffset = offset;
            }

            function startTimer() {
                console.log('Timer start clicked, isPaused:', isPaused);
                if (isPaused) {
                    isPaused = false;
                    startBtn.classList.add('hidden');
                    pauseBtn.classList.remove('hidden');
                    durationButtons.style.pointerEvents = 'none';
                    soundSelect.disabled = true;
                    ringContainer.classList.add('timer-active');
                    if (secondsRemaining === totalSeconds) sounds[soundSelect.value].play();
                    
                    timerInterval = setInterval(() => {
                        secondsRemaining--;
                        updateDisplay();
                        if (secondsRemaining <= 0) {
                            clearInterval(timerInterval);
                            sounds[soundSelect.value].play();
                            logSession();
                            resetTimer();
                        }
                    }, 1000);
                }
            }

            function pauseTimer() {
                isPaused = true;
                clearInterval(timerInterval);
                startBtn.textContent = 'Resume';
                startBtn.classList.remove('hidden');
                pauseBtn.classList.add('hidden');
                 ringContainer.classList.remove('timer-active');
            }

            function resetTimer() {
                clearInterval(timerInterval);
                isPaused = true;
                secondsRemaining = totalSeconds;
                updateDisplay();
                startBtn.textContent = 'Start';
                startBtn.classList.remove('hidden');
                pauseBtn.classList.add('hidden');
                durationButtons.style.pointerEvents = 'auto';
                soundSelect.disabled = false;
                ringContainer.classList.remove('timer-active');
            }
            
            function setDuration(minutes) {
                totalSeconds = minutes * 60;
                resetTimer();
            }

            function logSession() {
                try {
                    const log = JSON.parse(localStorage.getItem('practiceLog')) || [];
                    const today = new Date().toISOString().split('T')[0];
                    log.push({ date: today, duration: totalSeconds / 60 });
                    localStorage.setItem('practiceLog', JSON.stringify(log));
                } catch (e) {
                    console.error("Could not save practice log:", e);
                }
                displayPracticeLog();
            }

            function displayPracticeLog() {
                let log = [];
                try {
                    log = JSON.parse(localStorage.getItem('practiceLog')) || [];
                } catch(e) {
                    console.error("Could not read practice log:", e);
                }
                const logContainer = document.getElementById('practice-log');
                if (log.length > 0) {
                    const totalMinutes = log.reduce((sum, entry) => sum + entry.duration, 0);
                    let streak = 0;
                    if(log.length > 0) {
                        const uniqueDates = [...new Set(log.map(l => l.date))].sort().reverse();
                        let today = new Date();
                        if(new Date(uniqueDates[0]).toDateString() === today.toDateString()) {
                            streak = 1;
                        } else {
                            today.setDate(today.getDate() -1);
                             if(uniqueDates[0] && new Date(uniqueDates[0]).toDateString() === today.toDateString()) {
                                streak = 1;
                             }
                        }
                        
                        if (streak > 0) {
                             for(let i=0; i < uniqueDates.length -1; i++){
                                let d1 = new Date(uniqueDates[i]);
                                d1.setDate(d1.getDate() - 1);
                                let d2 = new Date(uniqueDates[i+1]);
                                if(d1.toDateString() === d2.toDateString()) {
                                    streak++;
                                } else {
                                    break;
                                }
                            }
                        }
                    }

                    logContainer.innerHTML = `
                        <h3 class="text-2xl font-bold font-lora mb-4">Practice Log</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                           <div><p class="text-charcoal/80">Total Minutes</p><strong class="text-2xl font-lora text-forest-green">${totalMinutes}</strong></div>
                           <div><p class="text-charcoal/80">Total Sessions</p><strong class="text-2xl font-lora text-forest-green">${log.length}</strong></div>
                           <div><p class="text-charcoal/80">Current Streak</p><strong class="text-2xl font-lora text-forest-green">${streak} days</strong></div>
                        </div>
                        <canvas id="practice-chart" class="mt-4 h-40 w-full"></canvas>
                    `;
                    
                    const canvas = document.getElementById('practice-chart');
                    const ctx = canvas.getContext('2d');
                    const last7DaysData = {};
                    for(let i = 6; i >= 0; i--) {
                        const d = new Date();
                        d.setDate(d.getDate() - i);
                        const key = d.toISOString().split('T')[0].slice(5);
                        last7DaysData[key] = 0;
                    }
                    log.forEach(entry => {
                        const key = entry.date.slice(5);
                        if(last7DaysData[key] !== undefined) {
                            last7DaysData[key] += entry.duration;
                        }
                    });
                     // Basic chart drawing - no external libs
                    const maxValue = Math.max(...Object.values(last7DaysData), 10);
                    const barWidth = canvas.width / 7;
                    let i = 0;
                    const isDark = document.documentElement.classList.contains('dark');
                    ctx.font = '12px Inter';
                    for(const [day, minutes] of Object.entries(last7DaysData)) {
                        const barHeight = (minutes / maxValue) * (canvas.height - 20);
                        ctx.fillStyle = isDark ? '#86b596' : 'var(--forest-green)';
                        ctx.fillRect(i * barWidth + 5, canvas.height - barHeight - 15, barWidth - 10, barHeight);
                        ctx.fillStyle = isDark ? '#d1d1d1' : 'var(--charcoal)';
                        ctx.fillText(day, i * barWidth + 10, canvas.height - 2);
                        i++;
                    }


                } else {
                     logContainer.innerHTML = `<p class="text-center text-charcoal/70">Your practice log will appear here once you complete a session.</p>`;
                }
            }

            durationButtons.addEventListener('click', e => {
                if (e.target.classList.contains('timer-duration-btn')) {
                    setDuration(parseInt(e.target.dataset.duration));
                }
            });
            
            startBtn.addEventListener('click', startTimer);
            pauseBtn.addEventListener('click', pauseTimer);
            resetBtn.addEventListener('click', resetTimer);

            updateDisplay();
            displayPracticeLog();
        }
        
        function attachWorkoutLogic() {
            const statusEl = document.getElementById('workout-status');
            const exerciseEl = document.getElementById('workout-exercise');
            const timerEl = document.getElementById('workout-timer');
            const nextEl = document.getElementById('workout-next-exercise');
            const startBtn = document.getElementById('workout-start-btn');
            const pauseBtn = document.getElementById('workout-pause-btn');
            const forwardBtn = document.getElementById('workout-forward-btn');
            const backBtn = document.getElementById('workout-back-btn');
            const doubleModeCheckbox = document.getElementById('workout-double-mode');
            const visualEl = document.getElementById('workout-visual');
            const soundSelect = document.getElementById('workout-sound');
            const instructionText = document.getElementById('workout-instruction-text');
            const phaseEl = document.getElementById('workout-phase');
            const progressText = document.getElementById('workout-progress-text');
            const progressBar = document.getElementById('workout-progress-bar');
            const totalTimeEl = document.getElementById('workout-total-time');
            const caloriesEl = document.getElementById('workout-calories');
            const completedEl = document.getElementById('workout-completed');

            let workoutPlan = [...db.workout.exercises];
            let currentExerciseIndex = 0;
            let isResting = true;
            let secondsRemaining = 10;
            let isPaused = true;
            let totalTime = 0;
            let totalCalories = 0;
            let completedExercises = 0;
            
            const bellSound = sounds.chime;

            function speak(text) {
                if (soundSelect.value === 'on' && 'speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = 1.2;
                    window.speechSynthesis.speak(utterance);
                }
            }
            
            function updateDisplay() {
                timerEl.textContent = secondsRemaining;
                const currentEx = workoutPlan[currentExerciseIndex];
                visualEl.innerHTML = currentEx.visual;
                
                // Update instructions
                if (currentEx.instructions) {
                    instructionText.textContent = currentEx.instructions;
                }
                
                // Update progress
                const progress = ((currentExerciseIndex + (isResting ? 0 : 1)) / workoutPlan.length) * 100;
                progressBar.style.width = `${progress}%`;
                progressText.textContent = `Exercise ${currentExerciseIndex + 1} of ${workoutPlan.length}`;
                
                // Update stats
                const minutes = Math.floor(totalTime / 60);
                const seconds = totalTime % 60;
                totalTimeEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                caloriesEl.textContent = totalCalories;
                completedEl.textContent = `${completedExercises}/${workoutPlan.length}`;
                
                if (isResting) {
                    statusEl.textContent = 'Get Ready!';
                    exerciseEl.textContent = currentEx.name;
                    phaseEl.textContent = 'Rest';
                    nextEl.style.visibility = 'visible';
                    
                    // Add pulse animation during rest
                    timerEl.classList.add('workout-pulse');
                    if (secondsRemaining === 3 && isPaused === false) speak(`Next: ${currentEx.name}`);
                } else {
                    statusEl.textContent = `Workout #${currentExerciseIndex + 1}`;
                    exerciseEl.textContent = currentEx.name;
                    phaseEl.textContent = 'Exercise';
                    nextEl.style.visibility = 'hidden';
                    
                    // Add bounce animation during exercise
                    timerEl.classList.remove('workout-pulse');
                    timerEl.classList.add('workout-bounce');
                }
                
                const nextIndex = currentExerciseIndex + 1;
                if(nextIndex < workoutPlan.length) {
                   nextEl.textContent = workoutPlan[nextIndex].name;
                } else {
                   nextEl.textContent = 'Last one!';
                }
            }
            
            function tick() {
                secondsRemaining--;
                totalTime++;
                
                // Add calories during exercise
                if (!isResting && workoutPlan[currentExerciseIndex].calories) {
                    const caloriesPerSecond = workoutPlan[currentExerciseIndex].calories / workoutPlan[currentExerciseIndex].duration;
                    totalCalories += caloriesPerSecond;
                }
                
                if (secondsRemaining <= 3 && secondsRemaining > 0) speak(secondsRemaining);
                if (secondsRemaining < 0) {
                    if (soundSelect.value === 'on') bellSound.play();
                    isResting = !isResting;
                    if (!isResting) { // Finished rest, start exercise
                        secondsRemaining = workoutPlan[currentExerciseIndex].duration;
                        speak('Begin');
                    } else { // Finished exercise, start rest
                        completedExercises++;
                        currentExerciseIndex++;
                        if (currentExerciseIndex >= workoutPlan.length) {
                            finishWorkout();
                            return;
                        }
                        secondsRemaining = db.workout.restDuration;
                    }
                }
                updateDisplay();
            }

            function startWorkout() {
                if (isPaused) {
                    isPaused = false;
                    startBtn.classList.add('hidden');
                    pauseBtn.classList.remove('hidden');
                    if(secondsRemaining === 10 && currentExerciseIndex === 0) {
                        speak(`Starting ${doubleModeCheckbox.checked ? '14' : '7'} minute workout.`);
                    }
                    workoutInterval = setInterval(tick, 1000);
                }
            }
            
            function pauseWorkout() {
                isPaused = true;
                clearInterval(workoutInterval);
                startBtn.textContent = 'Resume';
                startBtn.classList.remove('hidden');
                pauseBtn.classList.add('hidden');
            }

            function changeExercise(direction) {
                pauseWorkout();
                currentExerciseIndex += direction;
                if (currentExerciseIndex < 0) currentExerciseIndex = 0;
                if (currentExerciseIndex >= workoutPlan.length) currentExerciseIndex = workoutPlan.length - 1;
                isResting = true;
                secondsRemaining = db.workout.restDuration;
                updateDisplay();
            }

            function resetWorkout() {
                if (doubleModeCheckbox.checked) {
                    workoutPlan = [...db.workout.exercises, ...db.workout.exercises];
                } else {
                    workoutPlan = [...db.workout.exercises];
                }
                currentExerciseIndex = 0;
                isResting = true;
                secondsRemaining = 10;
                isPaused = true;
                totalTime = 0;
                totalCalories = 0;
                completedExercises = 0;
                clearInterval(workoutInterval);
                startBtn.textContent = 'Start Workout';
                startBtn.classList.remove('hidden');
                pauseBtn.classList.add('hidden');
                updateDisplay();
            }
            
            function finishWorkout() {
                 clearInterval(workoutInterval);
                 statusEl.textContent = 'Finished!';
                 exerciseEl.textContent = 'Well Done!';
                 timerEl.textContent = '🎉';
                 phaseEl.textContent = 'Complete';
                 nextEl.style.visibility = 'hidden';
                 
                 // Add celebration animation
                 timerEl.classList.remove('workout-pulse', 'workout-bounce');
                 timerEl.classList.add('workout-shake');
                 
                 // Update final stats
                 totalCalories = Math.round(totalCalories);
                 updateDisplay();
                 
                 speak('Workout complete. Well done!');
                 showNotification(`Workout complete! You burned ${totalCalories} calories in ${Math.floor(totalTime/60)}:${(totalTime%60).toString().padStart(2, '0')}`);
            }

            startBtn.addEventListener('click', startWorkout);
            pauseBtn.addEventListener('click', pauseWorkout);
            forwardBtn.addEventListener('click', () => changeExercise(1));
            backBtn.addEventListener('click', () => changeExercise(-1));
            doubleModeCheckbox.addEventListener('change', resetWorkout);

            resetWorkout(); // Initialize display
        }
        
        function attachInterviewLogic() {
            const questionEl = document.getElementById('interview-question');
            const liveVideo = document.getElementById('live-video');
            const playbackVideo = document.getElementById('playback-video');
            const startBtn = document.getElementById('start-recording-btn');
            const stopBtn = document.getElementById('stop-recording-btn');
            const nextBtn = document.getElementById('next-question-btn');
            const playbackSection = document.getElementById('playback-section');
            const recordingsList = document.getElementById('recordings-list');
            const noRecordingsMsg = document.getElementById('no-recordings-message');
            const catButtons = document.querySelectorAll('.interview-cat-btn');
            const feedbackEl = document.getElementById('interview-feedback');
            const cameraErrorEl = document.getElementById('camera-error');
            
            let currentCategory = 'general';
            let currentQuestionIndex = 0;
            sessionRecordings = [];

            function setCategory(category) {
                currentCategory = category;
                currentQuestionIndex = 0;
                updateQuestion();
                catButtons.forEach(btn => {
                    btn.classList.toggle('bg-earthy-gold', btn.dataset.category === category);
                     btn.classList.toggle('text-white', btn.dataset.category === category);
                });
            }

            function updateQuestion() {
                questionEl.textContent = db.interviewQuestions[currentCategory][currentQuestionIndex];
            }

            async function setupCamera() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                    if (!stream.getAudioTracks().length > 0) {
                        throw new Error("No audio track found. Please check microphone permissions.");
                    }
                    liveVideo.srcObject = stream;
                    
                    const options = { mimeType: 'video/webm;codecs=vp8,opus' };
                    if (!MediaRecorder.isTypeSupported(options.mimeType)) {
                         console.warn(`${options.mimeType} is not supported, using default.`);
                         mediaRecorder = new MediaRecorder(stream);
                    } else {
                         mediaRecorder = new MediaRecorder(stream, options);
                    }
                   
                    mediaRecorder.ondataavailable = e => recordedChunks.push(e.data);
                    mediaRecorder.onstop = () => {
                        const blob = new Blob(recordedChunks, { type: 'video/webm' });
                        recordedChunks = [];
                        const videoURL = URL.createObjectURL(blob);
                        addRecordingToList({
                            question: db.interviewQuestions[currentCategory][currentQuestionIndex],
                            url: videoURL,
                            timestamp: new Date()
                        });
                    };
                } catch (err) {
                    console.error("Error accessing camera:", err);
                    cameraErrorEl.classList.remove('hidden');
                }
            }
            
            function addRecordingToList(recording) {
                sessionRecordings.push(recording);
                noRecordingsMsg.classList.add('hidden');
                
                const item = document.createElement('div');
                item.className = 'p-4 bg-light-green dark:bg-gray-700/50 rounded-lg flex items-center justify-between';
                item.innerHTML = `
                    <div>
                        <p class="font-semibold text-charcoal">${recording.question}</p>
                        <p class="text-sm text-charcoal/70">${recording.timestamp.toLocaleTimeString()}</p>
                    </div>
                    <button class="play-recording-btn px-4 py-2 bg-forest-green text-white text-sm font-semibold rounded-lg hover:bg-forest-green/90 transition" data-url="${recording.url}">Play</button>
                `;
                recordingsList.appendChild(item);
                
                playbackVideo.src = recording.url;
                playbackVideo.classList.remove('hidden');
                playbackVideo.onended = showFeedback;
            }

            function showFeedback() {
                const feedbacks = ["Great pacing!", "Clear and confident delivery.", "Excellent example. Try to vary your tone slightly.", "Strong eye contact with the camera."];
                const randomFeedback = feedbacks[Math.floor(Math.random() * feedbacks.length)];
                feedbackEl.textContent = `💡 Feedback: ${randomFeedback}`;
                feedbackEl.classList.remove('hidden');
            }

            function startRecording() {
                if(mediaRecorder) {
                    recordedChunks = [];
                    mediaRecorder.start();
                    startBtn.classList.add('hidden');
                    stopBtn.classList.remove('hidden');
                    playbackVideo.classList.add('hidden');
                    feedbackEl.classList.add('hidden');
                }
            }

            function stopRecording() {
                if(mediaRecorder) {
                    mediaRecorder.stop();
                    startBtn.classList.remove('hidden');
                    stopBtn.classList.add('hidden');
                }
            }
            
            function nextQuestion() {
                currentQuestionIndex = (currentQuestionIndex + 1) % db.interviewQuestions[currentCategory].length;
                updateQuestion();
                playbackVideo.classList.add('hidden');
                feedbackEl.classList.add('hidden');
            }
            
            startBtn.addEventListener('click', startRecording);
            stopBtn.addEventListener('click', stopRecording);
            nextBtn.addEventListener('click', nextQuestion);
            catButtons.forEach(btn => btn.addEventListener('click', () => setCategory(btn.dataset.category)));
            recordingsList.addEventListener('click', (e) => {
                if(e.target.classList.contains('play-recording-btn')) {
                    playbackVideo.src = e.target.dataset.url;
                    playbackVideo.classList.remove('hidden');
                    playbackVideo.play();
                    feedbackEl.classList.add('hidden');
                }
            });
            
            setCategory('general');
            setupCamera();
        }
        
        function attachJournalLogic() {
            const timerEl = document.getElementById('journal-timer');
            const startBtn = document.getElementById('journal-start-btn');
            const entryEl = document.getElementById('journal-entry');
            const historyList = document.getElementById('journal-history-list');
            const durationSelect = document.getElementById('timer-duration');
            
            let secondsRemaining = 600;
            let totalDuration = 600;
            let isRunning = false;
            
            function updateDisplay() {
                const minutes = Math.floor(secondsRemaining / 60);
                const seconds = secondsRemaining % 60;
                timerEl.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
            }

            function resetTimer() {
                totalDuration = parseInt(durationSelect.value);
                secondsRemaining = totalDuration;
                updateDisplay();
                console.log('Journal timer reset to:', secondsRemaining, 'seconds');
            }

            function startJournal() {
                if(isRunning) return;
                isRunning = true;
                startBtn.disabled = true;
                startBtn.textContent = 'Writing...';
                startBtn.classList.add('opacity-50');
                durationSelect.disabled = true;

                journalInterval = setInterval(() => {
                    secondsRemaining--;
                    updateDisplay();
                    if(secondsRemaining <= 0) {
                        finishJournal();
                    }
                }, 1000);
            }

            function finishJournal() {
                clearInterval(journalInterval);
                sounds.chime.play();
                entryEl.disabled = true;
                startBtn.disabled = false;
                startBtn.textContent = 'Start New Entry';
                startBtn.classList.remove('opacity-50');
                durationSelect.disabled = false;
                saveEntry();
                resetTimer();
                isRunning = false;
            }
            
            function saveEntry() {
                const content = entryEl.value.trim();
                if (content === '') return;
                
                try {
                    const entries = JSON.parse(localStorage.getItem('journalEntries')) || [];
                    const newEntry = {
                        date: new Date().toISOString(),
                        content: content
                    };
                    entries.unshift(newEntry);
                    localStorage.setItem('journalEntries', JSON.stringify(entries));
                } catch(e) {
                    console.error("Failed to save journal entry:", e);
                }
                
                entryEl.value = '';
                displayEntries();
            }

            function displayEntries() {
                 let entries = [];
                try {
                    entries = JSON.parse(localStorage.getItem('journalEntries')) || [];
                } catch(e) {
                    console.error("Failed to load journal entries:", e);
                }
                historyList.innerHTML = '';
                if(entries.length === 0) {
                    historyList.innerHTML = `<p class="text-center text-charcoal/70">Your saved journal entries will appear here.</p>`;
                    return;
                }

                entries.forEach(entry => {
                    const date = new Date(entry.date);
                    const item = document.createElement('div');
                    item.className = 'bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-black/5';
                    item.innerHTML = `
                        <p class="font-semibold text-earthy-gold">${date.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                        <p class="mt-2 text-charcoal/80 whitespace-pre-wrap">${entry.content}</p>
                    `;
                    historyList.appendChild(item);
                });
            }
            
            // Duration selector change handler
            durationSelect.addEventListener('change', () => {
                if (!isRunning) {
                    resetTimer();
                }
            });

            entryEl.addEventListener('input', () => {
                if (!isRunning && entryEl.value.length > 0) {
                     startJournal();
                }
            });
            
            startBtn.addEventListener('click', () => {
                console.log('Journal start clicked');
                entryEl.disabled = false;
                entryEl.value = '';
                entryEl.focus();
            });

            // Quick preset buttons
            document.querySelectorAll('.quick-preset-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const duration = parseInt(btn.dataset.duration);
                    durationSelect.value = duration;
                    resetTimer();
                    // Visual feedback
                    document.querySelectorAll('.quick-preset-btn').forEach(b => b.classList.remove('ring-2', 'ring-forest-green'));
                    btn.classList.add('ring-2', 'ring-forest-green');
                });
            });

            // Initialize timer display
            resetTimer();
            displayEntries();
        }

    });
    </script>
</body>
</html>

