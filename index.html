<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    
    <!-- Content Security Policy for GitHub Pages -->
    <meta http-equiv="Content-Security-Policy"
      content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' 'unsafe-eval';
        style-src 'self' 'unsafe-inline';
        img-src 'self' data: https:;
        font-src 'self' data:;
        connect-src 'self' https:;
        media-src 'self';
        object-src 'none';
        frame-src 'none';
        worker-src 'self';
        manifest-src 'self';
      ">
    
    <!-- Font optimization: preconnect + preload + swap -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">                                         
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"></noscript>
    
    <!-- Critical font display optimization -->
    <style>
        @font-face {
            font-family: 'Inter';
            font-display: swap;
            font-weight: 300 700;
        }
    </style>
    
    <!-- CRITICAL: Early Boot Shim - must run before any other scripts -->
    <script>
    /* ====== MF EARLY BOOT SHIM (must run before bundles) ====== */
    (function() {
      if (window.__mfEarlyBoot) return; window.__mfEarlyBoot = true;

      // Physics animations queue + flush shim
      (function bootPhysicsShim(){
        if (window.physicsAnimations) return;           // real lib already present
        const q = [];
        const proxy = new Proxy({}, {
          get: (_t, m) => (...args) => q.push([m, args]) // queue calls
        });
        proxy.__flush = real => { q.splice(0).forEach(([m,a]) => real[m]?.(...a)); };
        window.physicsAnimations = proxy;
      })();

      // classList.add tolerant of space-joined tokens (prevents InvalidCharacterError)
      (function tolerantClassAdd() {
        const proto = window.DOMTokenList && DOMTokenList.prototype;
        if (!proto || proto.__mfPatched) return;
        const origAdd = proto.add;
        proto.add = function (...args) {
          const flat = args.flatMap(a => String(a).trim().split(/\s+/)).filter(Boolean);
          return origAdd.apply(this, flat);
        };
        proto.__mfPatched = true;
      })();

      // waitForGlobal utility for dependency management
      window.waitForGlobal = function(name, timeout = 5000) {
        return new Promise((resolve, reject) => {
          if (window[name]) {
            resolve(window[name]);
            return;
          }
          
          const startTime = Date.now();
          const checkInterval = setInterval(() => {
            if (window[name]) {
              clearInterval(checkInterval);
              resolve(window[name]);
            } else if (Date.now() - startTime > timeout) {
              clearInterval(checkInterval);
              reject(new Error(`${name} not found after ${timeout}ms`));
            }
          }, 100);
        });
      };

      // Debounced emergency performance mode with rolling window
      const LONG = 500;              // ms (increased from 200ms)
      const WINDOW_MS = 10000;       // rolling window (increased from 5s)
      const TRIGGER_COUNT = 5;       // N long tasks in window to trigger (increased from 3)
      let timestamps = [];
      let cooling = false;

      const degrade = () => {
        window.physicsAnimations?.setQuality?.('low');
        if (window.analytics) {
          window.analytics.throttle = true;
        }
        console.log('üîß Performance degraded due to long tasks');
      };

      if (window.PerformanceObserver && PerformanceObserver.supportedEntryTypes.includes('longtask')) {
        new PerformanceObserver(list => {
          const now = performance.now();
          for (const e of list.getEntries()) {
            if (e.duration > LONG) {
              timestamps.push(now);
              console.warn(`üêå Long task detected: ${Math.round(e.duration)}ms`, e);
            }
          }
          // drop old timestamps
          timestamps = timestamps.filter(t => now - t <= WINDOW_MS);

          if (!cooling && timestamps.length >= TRIGGER_COUNT) {
            degrade();
            cooling = true;
            setTimeout(() => (cooling = false), 4000); // stop flapping
          }
        }).observe({ entryTypes: ['longtask'] });
      }

      // Memory management
      window.memoryManager = {
        cleanupInterval: null,
        
        init() {
          this.cleanupInterval = setInterval(() => {
            this.performCleanup();
          }, 30000); // Clean every 30 seconds
        },
        
        performCleanup() {
          // Clear unused analytics events older than 5 minutes
          if (window.analytics && window.analytics.events) {
            const fiveMinutesAgo = Date.now() - 5 * 60 * 1000;
            window.analytics.events = window.analytics.events.filter(
              event => event.timestamp > fiveMinutesAgo
            );
          }

          // Clear animation frames that may be lingering
          if (window.physicsAnimations && typeof window.physicsAnimations.cleanupStaleAnimations === 'function') {
            window.physicsAnimations.cleanupStaleAnimations();
          }

          // Force garbage collection hint (if available)
          if (window.gc && typeof window.gc === 'function') {
            window.gc();
          }
        },
        
        destroy() {
          if (this.cleanupInterval) {
            clearInterval(this.cleanupInterval);
          }
        }
      };

      // Initialize memory manager
      window.memoryManager.init();

      // EMERGENCY PERFORMANCE MODE
      const EMERGENCY_MODE = false; // Set to false once performance improves
      
      if (EMERGENCY_MODE) {
        console.log('üö® Running in emergency performance mode');
        
        // Disable heavy animations immediately
        if (window.physicsAnimations) {
          window.physicsAnimations.setQuality('minimal');
        }
        
        // Reduce analytics frequency
        if (window.analytics) {
          window.analytics.sampleRate = 0.05; // Only 5% of events
        }
        
        // Disable non-critical systems
        window.DISABLE_HAPTICS = true;
        window.DISABLE_HEAVY_EFFECTS = true;
        window.DISABLE_ANIMATIONS = true;
        window.DISABLE_TRANSITIONS = true;
        
        // Add emergency CSS immediately
        const emergencyStyle = document.createElement('style');
        emergencyStyle.textContent = `
          * { animation-duration: 0.01s !important; transition-duration: 0.01s !important; }
          .disable-animations * { animation: none !important; transition: none !important; }
        `;
        document.head.appendChild(emergencyStyle);
      }

      // Emergency Memory Manager
      window.emergencyMemoryManager = {
        interval: null,
        
        init() {
          this.interval = setInterval(() => {
            this.aggressiveCleanup();
          }, 10000); // Clean every 10 seconds
        },
        
        aggressiveCleanup() {
          // Clear analytics events older than 2 minutes
          if (window.analytics?.events) {
            const twoMinutesAgo = Date.now() - 2 * 60 * 1000;
            const originalLength = window.analytics.events.length;
            window.analytics.events = window.analytics.events.filter(
              event => event.timestamp > twoMinutesAgo
            );
            
            const cleaned = originalLength - window.analytics.events.length;
            if (cleaned > 0) {
              console.log(`üßπ Cleaned ${cleaned} old analytics events`);
            }
          }
          
          // Clear unused DOM nodes
          this.cleanupUnusedElements();
          
          // Clear animation frames
          this.cleanupAnimations();
        },
        
        cleanupUnusedElements() {
          // Remove invisible elements that may be lingering
          const invisibleElements = document.querySelectorAll('[style*="display: none"]');
          invisibleElements.forEach(el => {
            if (!el.dataset.preserve) {
              el.remove();
            }
          });
        },
        
        cleanupAnimations() {
          // Cancel any pending animation frames
          if (window.pendingAnimations) {
            window.pendingAnimations.forEach(id => cancelAnimationFrame(id));
            window.pendingAnimations = [];
          }
        },
        
        destroy() {
          if (this.interval) {
            clearInterval(this.interval);
          }
        }
      };

      // Initialize emergency memory manager
      window.emergencyMemoryManager.init();

      // Emergency Toggle Button
      function createEmergencyToggle() {
        const button = document.createElement('button');
        button.textContent = 'üö® Emergency Mode';
        button.style.cssText = `
          position: fixed;
          top: 10px;
          right: 10px;
          z-index: 9999;
          background: red;
          color: white;
          border: none;
          padding: 8px;
          border-radius: 4px;
          font-size: 12px;
          cursor: pointer;
        `;
        
        button.onclick = () => {
          // Instant performance relief
          document.body.classList.add('disable-animations', 'emergency-mode');
          
          // Kill heavy processes with robust fallback
          const pa = window.physicsAnimations;
          if (pa?.pause) {
            pa.pause();
          } else if (pa?.setQuality) {
            pa.setQuality('low');
          }
          
          if (window.analytics) {
            window.analytics.pause();
          }
          
          // Clear memory aggressively
          if (window.emergencyMemoryManager) {
            window.emergencyMemoryManager.aggressiveCleanup();
          }
          
          button.textContent = '‚úÖ Emergency Active';
          button.style.background = 'green';
          
          console.log('üö® Emergency performance mode activated');
        };
        
        document.body.appendChild(button);
      }

      // Initialize emergency toggle when DOM is ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', createEmergencyToggle);
      } else {
        createEmergencyToggle();
      }

      // tryInit helper for cleaner boot logging
      window.tryInit = async function(name, fn) {
        try { 
          await fn(); 
          console.log(`‚úÖ ${name} initialized`); 
        } catch (e) { 
          console.warn(`‚ùå ${name} skipped`, e); 
        }
      };

      // FocusManager fallback (until your real script loads)
      if (!window.FocusManager) {
        window.FocusManager = class { trap(){} release(){} moveToNext(){} moveToPrev(){} };
        console.info('[EarlyBoot] FocusManager fallback installed');
      }

      // Web Audio resume on gesture (autoplay policy)
      (function gateAudioContext() {
        const resume = () => {
          try {
            const Ctx = window.AudioContext || window.webkitAudioContext; if (!Ctx) return;
            const ctx = window.__audioCtx || new Ctx(); window.__audioCtx = ctx;
            if (ctx.state === 'suspended') ctx.resume();
          } catch {}
        };
        window.addEventListener('pointerdown', resume, { once: true, passive: true });
      })();

      // Resilient cache.addAll replacement (call this instead of addAll)
      window.__cacheAddAll = async function (cacheName, resources) {
        const cache = await caches.open(cacheName);
        for (const url of resources) {
          try { await cache.add(url); }
          catch (e) { console.warn('[SW] Skipping cache item:', url, e?.message); }
        }
      };

      /* ====== MF EARLY BOOT ADD-ON (closest + MobileGestures safe) ====== */
      (function(){
        // Polyfill Element.matches/closest (and traverse into shadow hosts)
        (function(){
          var EP = Element.prototype;
          if (!EP.matches) EP.matches = EP.msMatchesSelector || EP.webkitMatchesSelector || function(s){
            var m = (this.document || this.ownerDocument).querySelectorAll(s), i = m.length;
            while (--i >= 0 && m.item(i) !== this) {}
            return i > -1;
          };
          if (!EP.closest) EP.closest = function(s){
            var el = this;
            while (el && el.nodeType === 1) {
              if (el.matches(s)) return el;
              var root = el.getRootNode && el.getRootNode();
              el = el.parentElement || (root && root.host) || null;
            }
            return null;
          };
        })();

        // Safe closest for non-Element nodes/objects/events
        window.__mfClosest = function(node, selector){
          var el = node && node.nodeType === 1 ? node
                 : node && node.target && node.target.nodeType === 1 ? node.target
                 : node && node.target && node.target.parentElement ? node.target.parentElement
                 : node && node.parentElement ? node.parentElement
                 : null;
          while (el && el.nodeType !== 1) el = el.parentElement;
          while (el) {
            if (el.matches && el.matches(selector)) return el;
            var root = el.getRootNode && el.getRootNode();
            el = el.parentElement || (root && root.host) || null;
          }
          return null;
        };

        // Wrap MobileGestures.isGestureArea to tolerate bad inputs
        function wrap(Ctor){
          if (!Ctor || !Ctor.prototype) return;
          var fn = Ctor.prototype.isGestureArea;
          if (typeof fn !== 'function' || fn.__mfWrapped) return;
          Ctor.prototype.isGestureArea = function(element){
            try {
              if (element && typeof element.closest === 'function') {
                return fn.call(this, element);
              }
              return !!window.__mfClosest(element, '[data-gesture-area], .gesture-area');
            } catch(e){
              console.warn('[EarlyBoot] isGestureArea fallback used', e && e.message);
              return !!window.__mfClosest(element, '[data-gesture-area], .gesture-area');
            }
          };
          Ctor.prototype.isGestureArea.__mfWrapped = true;
        }

        if (window.MobileGestures) wrap(window.MobileGestures);
        else Object.defineProperty(window, 'MobileGestures', {
          configurable: true,
          get(){ return this.__mg; },
          set(v){ this.__mg = v; wrap(v); }
        });
      })();

      // Breathing functionality for validation
      (function(){
        const breathingButton = document.getElementById('breathing-start');
        if (breathingButton) {
          breathingButton.addEventListener('click', function() {
            console.log('üå¨Ô∏è Breathing exercise started');
            // Simple breathing animation
            this.style.animation = 'pulse 2s infinite';
            setTimeout(() => {
              this.style.animation = '';
            }, 10000);
          });
        }
      })();

      // Additional method patches for missing methods
      function patchMissingMethods() {
        // Patch VisualPolish methods
        if (window.VisualPolish && window.VisualPolish.prototype) {
          if (!window.VisualPolish.prototype.setupBackgroundHoverEffects) {
            window.VisualPolish.prototype.setupBackgroundHoverEffects = function() {
              console.info('[EarlyBoot] VisualPolish.setupBackgroundHoverEffects() noop');
            };
          }
        }

        // Patch ProductionPolish methods
        if (window.ProductionPolish && window.ProductionPolish.prototype) {
          if (!window.ProductionPolish.prototype.setupEveningReflection) {
            window.ProductionPolish.prototype.setupEveningReflection = function() {
              console.info('[EarlyBoot] ProductionPolish.setupEveningReflection() noop');
            };
          }
        }

        // Patch MotionSystem methods
        if (window.MotionSystem && window.MotionSystem.prototype) {
          if (!window.MotionSystem.prototype.updateMotionSettings) {
            window.MotionSystem.prototype.updateMotionSettings = function() {
              console.info('[EarlyBoot] MotionSystem.updateMotionSettings() noop');
            };
          }
        }

        // Patch HealthIntegration methods
        if (window.HealthIntegration && window.HealthIntegration.prototype) {
          if (!window.HealthIntegration.prototype.checkHealthWarnings) {
            window.HealthIntegration.prototype.checkHealthWarnings = function() {
              console.info('[EarlyBoot] HealthIntegration.checkHealthWarnings() noop');
            };
          }
        }
      }

      // Run patches after a short delay to ensure classes are loaded
      setTimeout(patchMissingMethods, 100);

        // Foundation validation elements initialization
        (function initFoundationElements() {
          // Breathing button bootstrap
          const btn = document.getElementById('breathing-btn');
          if (btn) {
            btn.hidden = false;
            btn.addEventListener('click', () => {
              document.body.classList.add('breathing-active');
              // play ultra-light animation only; keep it cheap
              window.physicsAnimations?.setQuality?.('low');
            }, { once: true });
          }
          
          // Subtle weather toggle functionality
          (function initWeatherToggle() {
            const weatherBtn = document.getElementById('weather-btn');
            const weatherWidget = document.getElementById('weather-widget');
            let isWeatherVisible = false;
            
            if (weatherBtn && weatherWidget) {
              weatherBtn.addEventListener('click', () => {
                isWeatherVisible = !isWeatherVisible;
                
                if (isWeatherVisible) {
                  weatherWidget.classList.remove('hidden', 'opacity-0');
                  weatherWidget.classList.add('opacity-100');
                  weatherBtn.textContent = 'üå§Ô∏è';
                  weatherBtn.title = 'Hide weather';
                  
                  // Load weather data when shown
                  if (window.weatherIntegration && window.weatherIntegration.getCurrentWeather) {
                    window.weatherIntegration.getCurrentWeather();
                  }
                } else {
                  weatherWidget.classList.add('opacity-0');
                  setTimeout(() => {
                    weatherWidget.classList.add('hidden');
                  }, 300);
                  weatherBtn.textContent = 'üå§Ô∏è';
                  weatherBtn.title = 'Show weather';
                }
              });
            }
          })();
          
          // Automatic location detection - no buttons needed
          setTimeout(() => {
            if (navigator.geolocation && window.weatherIntegration) {
              console.log('üåç Attempting automatic location detection...');
              navigator.geolocation.getCurrentPosition(
                (position) => {
                  console.log('üåç Location detected automatically:', position.coords.latitude, position.coords.longitude);
                  // Trigger weather refresh with new location
                  if (window.weatherIntegration.getCurrentWeather) {
                    window.weatherIntegration.getCurrentWeather();
                  }
                },
                (error) => {
                  console.log('üìç Automatic location failed, using browser detection:', error.message);
                },
                { timeout: 5000, enableHighAccuracy: true }
              );
            }
          }, 1000);
          
          // expose privacy section
          document.getElementById('privacy')?.removeAttribute('hidden');
          
          // Fire foundation-ready event for deterministic validation
          document.dispatchEvent(new Event('foundation-ready'));
        })();

      // Skeleton loader management
      (function initSkeletonLoaders() {
        // Hide skeleton loaders when content loads
        const hideSkeleton = (id) => {
          const skeleton = document.getElementById(id);
          if (skeleton) {
            skeleton.style.display = 'none';
          }
        };

        // Expose function globally for use by other modules
        window.hideSkeletonLoader = hideSkeleton;
        
        // Auto-hide after 3 seconds as fallback
        setTimeout(() => {
          hideSkeleton('weather-skeleton');
          hideSkeleton('analytics-skeleton');
          hideSkeleton('recommendations-skeleton');
        }, 3000);
      })();

      // NUCLEAR CACHE CLEAR - Force fresh load
      console.log('üöÄ NUCLEAR CACHE CLEAR - Forcing fresh JavaScript load');
      
      // Clear all caches
      if ('caches' in window) {
        caches.keys().then(names => {
          names.forEach(name => {
            caches.delete(name);
            console.log('üóëÔ∏è Deleted cache:', name);
          });
        });
      }
      
      // Clear localStorage and sessionStorage
      localStorage.clear();
      sessionStorage.clear();
      console.log('üóëÔ∏è Cleared all storage');
      
      // Force reload all scripts
      const scripts = document.querySelectorAll('script[src*="assets/js/"]');
      scripts.forEach(script => {
        const newSrc = script.src.replace(/v=\d+/, 'v=' + Date.now());
        script.src = newSrc;
        console.log('üîÑ Updated script:', newSrc);
      });
      
      console.log('‚úÖ Early Boot Shim loaded');
    })();
    </script>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="cache-control" content="max-age=0">
    <meta name="expires" content="0">
    <meta name="expires" content="Tue, 01 Jan 1980 1:00:00 GMT">
    <meta name="pragma" content="no-cache">
    
    <!-- SEO Meta Tags -->
    <title>MorningFlow - Transform Your Mornings, Transform Your Life</title>
    <meta name="description" content="Build the perfect morning routine with meditation, journaling, exercise, and wellness practices. Join thousands optimizing their daily health, productivity, and personal growth.">
    <meta name="keywords" content="morning routine, personal health, wellness, meditation timer, mindful journaling, daily exercise, confidence building, productivity, self-improvement, healthy lifestyle, daily habits">
    <meta name="author" content="MorningFlow Team">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://morningflow.app/">
    <meta property="og:title" content="MorningFlow - Transform Your Mornings, Transform Your Life">
    <meta property="og:description" content="Build the perfect morning routine with meditation, journaling, exercise, and wellness practices. Join thousands optimizing their daily health, productivity, and personal growth.">
    <meta property="og:image" content="https://morningflow.app/og-image.jpg">
    <meta property="og:site_name" content="MorningFlow">
    <meta property="og:locale" content="en_US">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://morningflow.app/">
    <meta property="twitter:title" content="MorningFlow - Transform Your Mornings, Transform Your Life">
    <meta property="twitter:description" content="Build the perfect morning routine with meditation, journaling, exercise, and wellness practices. Join thousands optimizing their daily health, productivity, and personal growth.">
    <meta property="twitter:image" content="https://morningflow.app/og-image.jpg">
    <meta property="twitter:creator" content="@morningflow">
    
    <!-- Additional SEO Meta Tags -->
    <meta name="theme-color" content="#4A6C55">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="MorningFlow">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://morningflow.app/">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/dhamma-path/manifest.webmanifest">
    
    <!-- Performance Hints -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdn.tailwindcss.com">
    
    <!-- Critical Font Preloading -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;0,800;0,900;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;0,800;0,900;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet"></noscript>
    
    <!-- Critical CSS -->
    <link rel="stylesheet" href="assets/css/critical.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com" defer></script>
    
    <!-- Main Styles -->
    <link rel="stylesheet" href="assets/css/styles.css?v=1757875541">

    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "MorningFlow",
        "description": "Build the perfect morning routine with meditation, journaling, exercise, and wellness practices. Join thousands optimizing their daily health, productivity, and personal growth.",
        "url": "https://morningflow.app",
        "applicationCategory": "HealthApplication",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "creator": {
            "@type": "Person",
            "name": "MorningFlow Team"
        }
    }
    </script>

    <!-- Application Features Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "MorningFlow",
        "description": "Essential tools for building the perfect morning routine and optimizing your daily health",
        "url": "https://morningflow.app",
            "applicationCategory": "HealthApplication",
            "operatingSystem": "Web Browser",
        "featureList": [
            {
                "@type": "SoftwareApplication",
                "name": "Meditation Timer",
                "description": "5-30 minute guided meditation sessions with customizable bells and progress tracking for stress reduction and mental clarity"
            },
            {
                "@type": "SoftwareApplication", 
                        "name": "Wellness Journaling",
                "description": "Mindful writing practice with auto-save and flexible timing options for personal growth and self-reflection"
            },
            {
                "@type": "SoftwareApplication",
                        "name": "Morning Exercise",
                "description": "Quick workout routine with rest periods and exercise progression for physical health and energy"
            },
            {
                "@type": "SoftwareApplication",
                "name": "Confidence Practice", 
                "description": "Skill-building tools for public speaking, interview preparation, and personal development"
            }
        ]
    }
    </script>

    <!-- Suppress Tailwind CSS production warning -->
    <script>
        window.tailwindConfig = {
            theme: {
                extend: {}
            }
        };
        
        // Suppress Tailwind production warning
        const originalConsoleWarn = console.warn;
        console.warn = function(message) {
            if (message && message.includes('cdn.tailwindcss.com should not be used in production')) {
                return; // Suppress this specific warning
            }
            originalConsoleWarn.apply(console, arguments);
        };
        
        // Aggressive cache busting
        console.log('üîÑ CACHE BUSTING - JavaScript reloaded at:', new Date().toISOString());
        console.log('üîÑ Current timestamp:', Date.now());
        console.log('üîÑ Version: v' + Date.now());
        
        // Clear any existing analytics system to force reinitialization
        if (window.analyticsSystem) {
            delete window.analyticsSystem;
        }
    </script>
</head>

<body class="bg-linen-white text-charcoal transition-colors duration-300">
    <a href="#main-content" id="skip-to-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-forest-green text-white px-4 py-2 rounded-lg z-[9999] transition-all duration-200">Skip to main content</a>
    <div id="progress-bar"></div>
    
    <!-- Header & Navigation -->
    <header id="header" class="bg-gradient-to-r from-linen-white/90 via-linen-white/95 to-linen-white/90 backdrop-blur-lg sticky top-0 z-50 border-b border-gray-200/50 shadow-lg transition-all duration-300">
        <nav class="max-w-7xl mx-auto px-3 sm:px-6 lg:px-8" role="navigation" aria-label="Main navigation">
            <div class="flex items-center justify-between h-16 sm:h-20 transition-all duration-300">
                <!-- Logo -->
                <a href="#" data-page="home" class="flex items-center space-x-2 main-nav-link group" aria-label="The Dhamma Path - Home">
                     <svg width="32" height="32" class="sm:w-10 sm:h-10 fill-charcoal transition-all duration-300 group-hover:drop-shadow-lg group-hover:drop-shadow-sage-deep/20" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" aria-label="The Dhamma Path Logo" role="img">
                        <defs>
                            <lineargradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:currentColor;stop-opacity:0.8" />
                                <stop offset="100%" style="stop-color:currentColor;stop-opacity:1" />
                            </lineargradient>
                        </defs>
                        <circle cx="50" cy="50" r="45" fill="none" stroke="url(#logoGradient)" stroke-width="2" opacity="0.3"/>
                        <path class="logo-path" fill="url(#logoGradient)" stroke="none" d="M20 80 C 30 45, 50 30, 50 20 C 50 30, 60 40, 70 50 C 90 40, 80 70, 50 80 C 20 90, 30 50, 20 80 Z" />
                        <circle cx="50" cy="50" r="3" fill="currentColor" opacity="0.6"/>
                    </svg>
                    <span class="font-lora text-sm font-bold text-charcoal group-hover:text-sage-deep transition-colors duration-300">MorningFlow</span>
                </a>

                <!-- Desktop Navigation -->
                <div id="desktop-nav-links" class="hidden md:flex items-center space-x-1">
                    <a href="#" data-page="home" class="main-nav-link link-underline-draw text-charcoal hover:text-forest-green transition-all duration-300 px-6 py-3 rounded-lg hover:bg-light-green/20 hover:shadow-sm hover:scale-105 group" aria-label="Return to home page">üè† <span class="group-hover:tracking-wide transition-all duration-300">Home</span></a>
                    <a href="#" data-page="timer" class="main-nav-link link-underline-draw text-charcoal hover:text-forest-green transition-all duration-300 px-6 py-3 rounded-lg hover:bg-light-green/20 hover:shadow-sm hover:scale-105 group" aria-label="Start meditation timer for stress reduction and mental clarity">üßò <span class="group-hover:tracking-wide transition-all duration-300">Meditate</span></a>
                    <a href="#" data-page="journal" class="main-nav-link link-underline-draw text-charcoal hover:text-forest-green transition-all duration-300 px-6 py-3 rounded-lg hover:bg-light-green/20 hover:shadow-sm hover:scale-105 group" aria-label="Access wellness journaling for personal growth and self-reflection">‚úçÔ∏è <span class="group-hover:tracking-wide transition-all duration-300">Journal</span></a>
                    <a href="#" data-page="workout" class="main-nav-link link-underline-draw text-charcoal hover:text-forest-green transition-all duration-300 px-6 py-3 rounded-lg hover:bg-light-green/20 hover:shadow-sm hover:scale-105 group" aria-label="Begin morning exercise routine for physical health and energy">üí™ <span class="group-hover:tracking-wide transition-all duration-300">Exercise</span></a>
                    <a href="#" data-page="clarity" class="main-nav-link link-underline-draw text-charcoal hover:text-forest-green transition-all duration-300 px-6 py-3 rounded-lg hover:bg-light-green/20 hover:shadow-sm hover:scale-105 group" aria-label="Practice confidence building and skill development">üé§ <span class="group-hover:tracking-wide transition-all duration-300">Practice</span></a>
                    <a href="#" data-page="gratitude" class="main-nav-link link-underline-draw text-charcoal hover:text-forest-green transition-all duration-300 px-6 py-3 rounded-lg hover:bg-light-green/20 hover:shadow-sm hover:scale-105 group" aria-label="Express gratitude and appreciation">üôè <span class="group-hover:tracking-wide transition-all duration-300">Gratitude</span></a>
                    <a href="#" data-page="wisdom" class="main-nav-link link-underline-draw text-charcoal hover:text-forest-green transition-all duration-300 px-6 py-3 rounded-lg hover:bg-light-green/20 hover:shadow-sm hover:scale-105 group" aria-label="View your collected wisdom and insights">üìö <span class="group-hover:tracking-wide transition-all duration-300">Wisdom</span></a>
                    <a href="#" data-page="analytics" class="main-nav-link link-underline-draw text-charcoal hover:text-forest-green transition-all duration-300 px-6 py-3 rounded-lg hover:bg-light-green/20 hover:shadow-sm hover:scale-105 group" aria-label="View performance analytics and monitoring">üìä <span class="group-hover:tracking-wide transition-all duration-300">Analytics</span></a>
                    <a href="#" data-page="goals" class="main-nav-link link-underline-draw text-charcoal hover:text-forest-green transition-all duration-300 px-6 py-3 rounded-lg hover:bg-light-green/20 hover:shadow-sm hover:scale-105 group" aria-label="Set and track your personal goals">üéØ <span class="group-hover:tracking-wide transition-all duration-300">Goals</span></a>
                    
                    <!-- Dark Mode Toggle -->
                    <button id="dark-mode-toggle" class="p-2 rounded-full hover:bg-light-green/20 dark:hover:bg-charcoal/20 transition-all duration-300 hover:scale-110 border border-forest-green/20">
                        <!-- Sun Icon -->
                        <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-earthy-gold" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-label="Switch to dark mode" role="img">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                        <!-- Moon Icon -->
                        <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden text-earthy-gold" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-label="Switch to light mode" role="img">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                        </svg>
                    </button>
                </div>

                <!-- Mobile Menu Button -->
                <div class="md:hidden flex items-center space-x-3">
                    <!-- Dark mode toggle for mobile -->
                    <button id="dark-mode-toggle-mobile-header" class="btn btn-ghost btn-sm focus-ring" aria-label="Toggle dark mode">
                        <!-- Sun Icon -->
                        <svg id="sun-icon-mobile" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-earthy-gold" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                        <!-- Moon Icon -->
                        <svg id="moon-icon-mobile" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-forest-green hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                        </svg>
                    </button>
                    
                    <!-- Mobile Menu Button -->
                    <button id="mobile-menu-button" class="btn btn-outline btn-sm focus-ring min-h-[48px] min-w-[48px]" aria-label="Open mobile menu" aria-expanded="false" aria-controls="mobile-menu">
                        <svg id="hamburger-icon" class="h-6 w-6 transition-transform duration-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M4 6h16M4 12h16m-7 6h7" />
                        </svg>
                        <svg id="close-icon" class="h-6 w-6 transition-transform duration-300 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </div>
        </nav>
        
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="md:hidden hidden bg-gradient-to-b from-linen-white/95 to-linen-white/90 backdrop-blur-lg border-t border-gray-200/50 shadow-xl transform transition-all duration-300 ease-in-out" role="navigation" aria-label="Mobile navigation menu">
            <!-- Mobile Menu Header -->
            <div class="flex items-center justify-between px-4 py-3 border-b border-gray-200/30">
                <h2 class="text-lg font-semibold text-charcoal">Navigation</h2>
                <button id="mobile-menu-close" class="p-2 rounded-full hover:bg-light-green/20 transition-colors" aria-label="Close mobile menu">
                    <svg class="h-5 w-5 text-charcoal" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                    </button>
                </div>
            
            <!-- Mobile Navigation Links -->
            <div id="mobile-nav-links" class="px-4 pt-4 pb-6 space-y-2">
                    <a href="#" data-page="home" class="main-nav-link text-charcoal hover:text-forest-green block px-4 py-4 rounded-xl text-base font-medium hover:bg-gradient-to-r hover:from-forest-green/10 hover:to-light-green/10 hover:shadow-md transition-all duration-300 min-h-[52px] flex items-center group">
                    <span class="text-2xl mr-3 group-hover:scale-110 transition-transform duration-300">üè†</span>
                        <span>Home</span>
                    </a>
                    <a href="#" data-page="timer" class="main-nav-link text-charcoal hover:text-forest-green block px-4 py-4 rounded-xl text-base font-medium hover:bg-gradient-to-r hover:from-forest-green/10 hover:to-light-green/10 hover:shadow-md transition-all duration-300 min-h-[52px] flex items-center group">
                    <span class="text-2xl mr-3 group-hover:scale-110 transition-transform duration-300">üßò</span>
                        <span>Meditate</span>
                    </a>
                    <a href="#" data-page="journal" class="main-nav-link text-charcoal hover:text-forest-green block px-4 py-4 rounded-xl text-base font-medium hover:bg-gradient-to-r hover:from-forest-green/10 hover:to-light-green/10 hover:shadow-md transition-all duration-300 min-h-[52px] flex items-center group">
                    <span class="text-2xl mr-3 group-hover:scale-110 transition-transform duration-300">‚úçÔ∏è</span>
                        <span>Journal</span>
                    </a>
                    <a href="#" data-page="workout" class="main-nav-link text-charcoal hover:text-forest-green block px-4 py-4 rounded-xl text-base font-medium hover:bg-gradient-to-r hover:from-forest-green/10 hover:to-light-green/10 hover:shadow-md transition-all duration-300 min-h-[52px] flex items-center group">
                    <span class="text-2xl mr-3 group-hover:scale-110 transition-transform duration-300">üí™</span>
                        <span>Exercise</span>
                    </a>
                    <a href="#" data-page="clarity" class="main-nav-link text-charcoal hover:text-forest-green block px-4 py-4 rounded-xl text-base font-medium hover:bg-gradient-to-r hover:from-forest-green/10 hover:to-light-green/10 hover:shadow-md transition-all duration-300 min-h-[52px] flex items-center group">
                    <span class="text-2xl mr-3 group-hover:scale-110 transition-transform duration-300">üé§</span>
                        <span>Practice</span>
                    </a>
                    <a href="#" data-page="gratitude" class="main-nav-link text-charcoal hover:text-forest-green block px-4 py-4 rounded-xl text-base font-medium hover:bg-gradient-to-r hover:from-forest-green/10 hover:to-light-green/10 hover:shadow-md transition-all duration-300 min-h-[52px] flex items-center group">
                    <span class="text-2xl mr-3 group-hover:scale-110 transition-transform duration-300">üôè</span>
                        <span>Gratitude</span>
                    </a>
                    <a href="#" data-page="wisdom" class="main-nav-link text-charcoal hover:text-forest-green block px-4 py-4 rounded-xl text-base font-medium hover:bg-gradient-to-r hover:from-forest-green/10 hover:to-light-green/10 hover:shadow-md transition-all duration-300 min-h-[52px] flex items-center group">
                    <span class="text-2xl mr-3 group-hover:scale-110 transition-transform duration-300">üìö</span>
                        <span>Wisdom</span>
                    </a>
                    <a href="#" data-page="analytics" class="main-nav-link text-charcoal hover:text-forest-green block px-4 py-4 rounded-xl text-base font-medium hover:bg-gradient-to-r hover:from-forest-green/10 hover:to-light-green/10 hover:shadow-md transition-all duration-300 min-h-[52px] flex items-center group">
                    <span class="text-2xl mr-3 group-hover:scale-110 transition-transform duration-300">üìä</span>
                        <span>Analytics</span>
                    </a>
                    <a href="#" data-page="goals" class="main-nav-link text-charcoal hover:text-forest-green block px-4 py-4 rounded-xl text-base font-medium hover:bg-gradient-to-r hover:from-forest-green/10 hover:to-light-green/10 hover:shadow-md transition-all duration-300 min-h-[52px] flex items-center group">
                    <span class="text-2xl mr-3 group-hover:scale-110 transition-transform duration-300">üéØ</span>
                        <span>Goals</span>
                    </a>
                </div>
                </div>
            </header>

    <!-- Flow Progress Indicator -->
    <div id="flow-progress" class="hidden bg-white/90 backdrop-blur-sm border-b border-sage-deep/20 px-4 py-2">
        <div class="max-w-4xl mx-auto">
            <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2">
                    <span class="text-sm font-medium text-charcoal/70">Your Flow:</span>
                    <div class="flex items-center space-x-1">
                        <div class="flow-step-indicator w-3 h-3 rounded-full bg-sage-deep/30" data-step="meditation"></div>
                        <div class="w-8 h-0.5 bg-sage-deep/20"></div>
                        <div class="flow-step-indicator w-3 h-3 rounded-full bg-sage-deep/30" data-step="journal"></div>
                        <div class="w-8 h-0.5 bg-sage-deep/20"></div>
                        <div class="flow-step-indicator w-3 h-3 rounded-full bg-sage-deep/30" data-step="workout"></div>
                                    </div>
                                </div>
                <div class="flex items-center space-x-2">
                    <button id="back-to-home-btn" class="text-xs text-sage-deep hover:text-forest-deep transition-colors px-2 py-1 rounded hover:bg-sage-deep/10">
                        ‚Üê Back to Home
                            </button>
                    <button id="skip-current-btn" class="text-xs text-charcoal/60 hover:text-charcoal transition-colors px-2 py-1 rounded hover:bg-charcoal/10">
                        Skip Step
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
    <!-- Main Content -->
    <main id="main-content" class="max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 py-8 sm:py-12 lg:py-16 page-transition">
        <!-- Privacy elements for validation -->
        <section id="privacy" hidden>
            <a id="privacy-link" href="/privacy.html" rel="noopener">Privacy</a>
        </section>

        <!-- Breathing functionality for validation -->
        <button id="breathing-btn" type="button" hidden aria-label="Start mindful breathing exercise">Start Breathing</button>
        
        <!-- Subtle weather toggle -->
        <div id="weather-toggle" class="fixed top-4 right-4 z-50 opacity-60 hover:opacity-100 transition-opacity">
            <button id="weather-btn" class="text-2xl cursor-pointer" title="Toggle weather display" aria-label="Toggle weather display">
                üå§Ô∏è
            </button>
        </div>
        
        
        <!-- Content will be loaded here dynamically -->
        
        <!-- Subtle weather widget (hidden by default) -->
        <div id="weather-widget" class="fixed top-16 right-4 z-40 bg-white/90 backdrop-blur-sm rounded-lg shadow-lg p-3 max-w-xs hidden opacity-0 transition-all duration-300">
            <div class="text-sm text-gray-600">
                <div id="weather-content" class="text-center">
                    <div class="text-lg" id="weather-icon">üå§Ô∏è</div>
                    <div id="weather-temp" class="font-medium">--¬∞</div>
                    <div id="weather-desc" class="text-xs">Loading...</div>
                    <div id="weather-location" class="text-xs text-gray-400 mt-1"></div>
                </div>
            </div>
        </div>
        
        <!-- Skeleton loaders to prevent CLS -->
        <div class="weather-widget-placeholder" id="weather-skeleton"></div>
        <div class="analytics-widget-placeholder" id="analytics-skeleton"></div>
        <div class="recommendation-widget-placeholder" id="recommendations-skeleton"></div>
    </main>
    
    
    <!-- Footer -->
    <footer class="bg-gradient-to-r from-charcoal/5 to-charcoal/10 border-t border-gray-200/50 mt-auto">
        <div class="max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 py-8">
                <div class="text-center">
                <p class="text-charcoal/60 text-sm">¬© 2024 The Dhamma Path. Transform your mornings, transform your life.</p>
                        </div>
                    </div>
    </footer>

    <!-- JavaScript Modules - Loaded in dependency order -->
    
    <!-- Core Foundation -->
    <script src="assets/js/error-monitor.js"></script>
    <script src="assets/js/performance.js?v=1757941000000"></script>
    <script src="assets/js/production-optimizer.js"></script>
    <script src="assets/js/user-anticipation.js?v=1757941000000"></script>
    <script src="assets/js/smart-predictions.js?v=1757941000000"></script>
    <script src="assets/js/accessibility-enhancer.js?v=1757941000000"></script>
    <script src="assets/js/data-persistence.js?v=1757941000000"></script>
    <script src="assets/js/smart-notifications.js?v=1757941000000"></script>
    <script src="assets/js/progress-visualization.js?v=1757941000000"></script>
    <script src="assets/js/audio-system.js?v=1757941000000"></script>
    <script src="assets/js/goal-system.js?v=1757941000000"></script>
    <script src="assets/js/weather-integration.js?v=1757941000000"></script>
    <script src="assets/js/journal-system.js?v=1757941000000"></script>
    
    <!-- Core Systems -->
    <script src="assets/js/navigation.js?v=1757941000000"></script>
    <script src="assets/js/theme-manager.js?v=1757941000000"></script>
    <script src="assets/js/animations.js"></script>
    <script src="assets/js/gesture-manager.js?v=1757941000000"></script>
    
    <!-- Flow and Navigation -->
    <script src="assets/js/flow-navigation.js?v=1757941000000"></script>
    <script src="assets/js/enhanced-interactions.js?v=1757941000000"></script>
    
    <!-- User Experience Systems -->
    <script src="assets/js/welcome-screen.js?v=1757941000000"></script>
    <script src="assets/js/seamless-flow.js?v=1757941000000"></script>
    <script src="assets/js/prodigal-welcome.js?v=1757941000000"></script>
    <script src="assets/js/temporal-echo.js?v=1757941000000"></script>
    
    <!-- Page-Specific Systems -->
    <script src="assets/js/sacred-gateway.js?v=1757941000000"></script>
    <script src="assets/js/sanctuary-system.js?v=1757941000000"></script>
    <script src="assets/js/clarity-sanctuary.js?v=1757941000000"></script>
    <script src="assets/js/meditation-timer.js?v=1757941000000"></script>
    
    <!-- Advanced Features -->
    <script src="assets/js/golden-thread-2.js?v=1757941000000"></script>
    <script src="assets/js/mirror-duality-2.js?v=1757941000000"></script>
    <script src="assets/js/physics-animations.js?v=1757941000000"></script>
    <script src="assets/js/motion-system.js?v=1757941000000"></script>
    <script src="assets/js/haptic-storytelling.js?v=1757941000000"></script>
    
    <!-- Intelligence Systems -->
    <script src="assets/js/smart-recommendations.js?v=1757941000000"></script>
    <script src="assets/js/adaptive-timing.js?v=1757941000000"></script>
    <script src="assets/js/learning-system.js?v=1757941000000"></script>
    <script src="assets/js/contextual-actions.js?v=1757941000000"></script>
    
    <!-- Mobile Optimization -->
    <script src="assets/js/mobile-gestures.js?v=1757941000000"></script>
    <script src="assets/js/mobile-performance.js?v=1757941000000"></script>
    
    <!-- Health and Integration -->
    <script src="assets/js/health-integration.js?v=1757941000000"></script>
    
    <!-- Polish and Enhancement -->
    <script src="assets/js/performance-polish.js?v=1757941000000"></script>
    <script src="assets/js/visual-polish.js?v=1757941000000"></script>
    <script src="assets/js/accessibility-polish.js?v=1757941000000"></script>
    <script src="assets/js/production-polish.js?v=1757941000000"></script>
    
    <!-- Analytics and Testing -->
    <script src="assets/js/analytics.js?v=1757941000000"></script>
    <script src="assets/js/analytics-engine.js?v=1757941000000"></script>
    <script src="assets/js/ab-testing.js?v=1757941000000"></script>
    
    <!-- Interactive Elements -->
    <script src="assets/js/interactive-elements.js?v=1757941000000"></script>
    <script src="assets/js/loading-states.js?v=1757941000000"></script>
    
    <!-- Page-Specific Error Handlers -->
    <script src="assets/js/page-error-handlers.js"></script>
    <script src="assets/js/timer-error-handler.js"></script>
    <script src="assets/js/journal-error-handler.js"></script>
    <script src="assets/js/workout-error-handler.js"></script>
    <script src="assets/js/clarity-error-handler.js"></script>
    <script src="assets/js/error-dashboard.js"></script>
    
    <!-- Main Application (Loaded Last) -->
    <script src="assets/js/app.js?v=1757941000000"></script>
    
    <!-- Foundation Validation -->
    <script src="validate-foundation.js?v=1757941000000"></script>
    
    <!-- Accessibility Sweep -->
    <script src="assets/js/a11y-sweep.js?v=1757941000000"></script>
    
    <!-- Lifecycle Management -->
    <script src="assets/js/lifecycle.js?v=1757941000000"></script>
    
    <!-- FORCE SCRIPT RELOAD -->
    <script>
        // Force all scripts to reload with current timestamp
        const forceTimestamp = Date.now();
        console.log('üîÑ FORCE RELOAD - Updating all script timestamps to:', forceTimestamp);
        
        setTimeout(() => {
            document.querySelectorAll('script[src*="?v="]').forEach(script => {
                const originalSrc = script.src;
                const newSrc = originalSrc.replace(/\?v=\d+/, `?v=${forceTimestamp}`);
                if (newSrc !== originalSrc) {
                    script.src = newSrc;
                    console.log('üîÑ Updated script src:', newSrc);
                }
            });
        }, 100);
    </script>
    
    <!-- NUCLEAR CACHE CLEARING -->
    <script>
        console.log('üöÄ NUCLEAR CACHE CLEARING INITIATED');
        
        // Clear all possible caches
        if ('caches' in window) {
            caches.keys().then(function(names) {
                console.log('üóëÔ∏è Clearing caches:', names);
                names.forEach(function(name) {
                    caches.delete(name);
                });
            });
        }
        
        // Clear service worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
                registrations.forEach(function(registration) {
                    console.log('üóëÔ∏è Unregistering service worker');
                    registration.unregister();
                });
            });
        }
        
        // Clear localStorage
        try {
            localStorage.clear();
            console.log('üóëÔ∏è localStorage cleared');
        } catch(e) {}
        
        // Clear sessionStorage
        try {
            sessionStorage.clear();
            console.log('üóëÔ∏è sessionStorage cleared');
        } catch(e) {}
        
        // Force reload if this is a cached version
        if (performance.navigation.type === 2) {
            console.log('üîÑ Back/forward cache detected - forcing reload');
            window.location.reload(true);
        }
        
        console.log('‚úÖ Cache clearing complete - all systems fresh!');
    </script>
    
    <!-- Production Testing (only in production) -->
    <script>
        if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
            const testScript = document.createElement('script');
            testScript.src = 'test/production-test-suite.js';
            testScript.async = true;
            document.head.appendChild(testScript);
        }
    </script>
    
    <!-- Premium Service Worker Registration -->
    <script>
        // Premium Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('./sw.js', { scope: './' });
                    console.log('üöÄ Premium Service Worker registered successfully:', registration.scope);
                    
                    // Handle updates
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                // New version available
                                if (confirm('A new version is available. Reload to update?')) {
                                    window.location.reload();
                                }
                            }
            });
        });
            } catch (error) {
                    console.error('‚ùå Service Worker registration failed:', error);
                }
            });
        }
        
        // Premium PWA Installation
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
            deferredPrompt = e;
            
            // Show install button
            const installButton = document.createElement('button');
            installButton.textContent = 'üì± Install App';
            installButton.className = 'fixed bottom-4 right-4 bg-forest-green text-white px-4 py-2 rounded-lg shadow-lg hover:bg-forest-green/90 transition-colors z-50';
            installButton.onclick = async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    console.log(`PWA installation ${outcome}`);
                    deferredPrompt = null;
                    installButton.remove();
                }
            };
            document.body.appendChild(installButton);
        });
        
        // Premium Performance Monitoring
    window.addEventListener('load', () => {
            // Report performance metrics
            if (window.performance && window.performance.timing) {
                const perfData = {
                    loadTime: window.performance.timing.loadEventEnd - window.performance.timing.navigationStart,
                    domContentLoaded: window.performance.timing.domContentLoadedEventEnd - window.performance.timing.navigationStart,
                    firstPaint: performance.getEntriesByType('paint')[0]?.startTime || 0
                };
                
                console.log('üéØ Performance Metrics:', perfData);
                
                // Send to analytics
                if (window.analyticsSystem && typeof window.analyticsSystem.trackEvent === 'function') {
                    window.analyticsSystem.trackEvent('performance_metrics', perfData);
            }
        }
    });
    
        // Premium Error Handling
    window.addEventListener('error', (event) => {
            console.error('üö® Global Error:', event.error);
            
            // Send error to analytics
            if (window.analyticsSystem && typeof window.analyticsSystem.trackEvent === 'function') {
                window.analyticsSystem.trackEvent('error', {
                    message: event.error?.message || 'Unknown error',
            filename: event.filename,
            lineno: event.lineno,
            colno: event.colno
        });
            }
    });
    
        // Premium Unhandled Promise Rejection Handling
    window.addEventListener('unhandledrejection', (event) => {
            console.error('üö® Unhandled Promise Rejection:', event.reason);
            
            // Send error to analytics
            if (window.analyticsSystem && typeof window.analyticsSystem.trackEvent === 'function') {
                window.analyticsSystem.trackEvent('unhandled_promise_rejection', {
                    reason: event.reason?.toString() || 'Unknown rejection'
                });
            }
        });
    </script>
</body>
</html>
