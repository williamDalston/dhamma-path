<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <!-- GitHub Pages base path configuration - MUST be first! -->
    <base href="/dhamma-path/">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="cache-control" content="max-age=0">
    <meta name="expires" content="0">
    <meta name="expires" content="Tue, 01 Jan 1980 1:00:00 GMT">
    <meta name="pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    
    <!-- GitHub Pages base path configuration -->
    <script>
      // Ensure base href is set correctly
      (function ensureBaseHref(){
        const want = '/dhamma-path/';
        let b = document.head.querySelector('base');
        if (!b) {
          b = document.createElement('base');
          b.href = want;
          document.head.prepend(b);
        } else if (!b.href.includes(want)) {
          b.href = want; // normalize
        }
        window.__APP_BASE__ = want;
      })();
      
      // Fallback if <base> changes or you run locally
      (function () {
        const fromBaseTag = document.querySelector('base')?.getAttribute('href') || '';
        const repoBase = fromBaseTag || (location.pathname.includes('/dhamma-path/') ? '/dhamma-path/' : '/');
        window.__APP_BASE__ = repoBase;

      // Normalize any hard-coded root URLs to the repo base (runs early)
      const fix = (u) => {
        if (!u) return u;
        if (/^https?:\/\//i.test(u)) return u;      // absolute ok
        if (u.startsWith(repoBase)) return u;       // already ok
        if (u.startsWith('/')) return repoBase + u.slice(1);
        return repoBase + u;
      };
      
      // Fix all existing script and link URLs immediately
      document.querySelectorAll('link[href],script[src]').forEach(el => {
        if (el.hasAttribute('href')) {
          const href = el.getAttribute('href');
          if (href && !href.startsWith('http') && href.startsWith('/')) {
            el.setAttribute('href', fix(href));
          }
        }
        if (el.hasAttribute('src')) {
          const src = el.getAttribute('src');
          if (src && !src.startsWith('http') && src.startsWith('/')) {
            el.setAttribute('src', fix(src));
          }
        }
      });
      
      window.__fixPath = fix;
      
      // appURL helper for consistent path resolution
      window.appURL = function(p = '') {
        if (/^https?:\/\//.test(p)) return p;         // absolute stays absolute
        const base = document.baseURI || location.origin + '/dhamma-path/';
        return new URL(p.replace(/^\//, ''), base).toString();
      };
      })();
    </script>
    
    <!-- Comprehensive Path Normalization -->
    <script>
    (function normalizePaths(){
      const PREFIX = '/dhamma-path/';
      const absolutize = (u) => {
        if (!u) return u;
        if (/^https?:\/\//.test(u)) return u;
        return u.startsWith('/') ? PREFIX + u.slice(1) : u;
      };

      // Fix existing <link> hrefs that start with '/'
      document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('link[href^="/"]').forEach(link => {
          const raw = link.getAttribute('href');
          link.setAttribute('href', absolutize(raw));
        });
      });

      // Safety wrap Cache.add / addAll used by your precache code
      const _add = Cache.prototype.add;
      const _addAll = Cache.prototype.addAll;
      Cache.prototype.add = function(u){ return _add.call(this, absolutize(u)); };
      Cache.prototype.addAll = function(list){ return _addAll.call(this, list.map(absolutize)); };

      // Optional: normalize string fetch() calls
      const _fetch = window.fetch;
      window.fetch = function(input, init){
        if (typeof input === 'string') return _fetch(absolutize(input), init);
        if (input instanceof Request) {
          const url = absolutize(input.url);
          if (url === input.url) return _fetch(input, init);
          return _fetch(new Request(url, input), init);
        }
        return _fetch(input, init);
      };
    })();
    </script>
    
    <!-- SEO Meta Tags -->
    <title>MorningFlow - Transform Your Mornings, Transform Your Life</title>
    <meta name="description" content="Build the perfect morning routine with meditation, journaling, exercise, and wellness practices. Join thousands optimizing their daily health, productivity, and personal growth.">
    <meta name="keywords" content="morning routine, personal health, wellness, meditation timer, mindful journaling, daily exercise, confidence building, productivity, self-improvement, healthy lifestyle, daily habits">
    <meta name="author" content="MorningFlow Team">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://morningflow.app/">
    <meta property="og:title" content="MorningFlow - Transform Your Mornings, Transform Your Life">
    <meta property="og:description" content="Build the perfect morning routine with meditation, journaling, exercise, and wellness practices. Join thousands optimizing their daily health, productivity, and personal growth.">
    <meta property="og:image" content="https://morningflow.app/og-image.jpg">
    <meta property="og:site_name" content="MorningFlow">
    <meta property="og:locale" content="en_US">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://morningflow.app/">
    <meta property="twitter:title" content="MorningFlow - Transform Your Mornings, Transform Your Life">
    <meta property="twitter:description" content="Build the perfect morning routine with meditation, journaling, exercise, and wellness practices. Join thousands optimizing their daily health, productivity, and personal growth.">
    <meta property="twitter:image" content="https://morningflow.app/og-image.jpg">
    <meta property="twitter:creator" content="@morningflow">
    
    <!-- Additional SEO Meta Tags -->
    <meta name="theme-color" content="#4A6C55">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="MorningFlow">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://morningflow.app/">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Performance Hints -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdn.tailwindcss.com">
    
    <!-- Critical Font Preloading -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;0,800;0,900;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;0,800;0,900;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet"></noscript>
    
    <!-- Critical CSS -->
    <link rel="stylesheet" href="assets/css/critical.css?v=1757892007000">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com" defer></script>
    
    <!-- Main Styles -->
    <link rel="stylesheet" href="assets/css/styles.css?v=1757892007000">

    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "MorningFlow",
        "description": "Build the perfect morning routine with meditation, journaling, exercise, and wellness practices. Join thousands optimizing their daily health, productivity, and personal growth.",
        "url": "https://morningflow.app",
        "applicationCategory": "HealthApplication",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "creator": {
            "@type": "Person",
            "name": "MorningFlow Team"
        }
    }
    </script>

    <!-- Application Features Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "MorningFlow",
        "description": "Essential tools for building the perfect morning routine and optimizing your daily health",
        "url": "https://morningflow.app",
            "applicationCategory": "HealthApplication",
            "operatingSystem": "Web Browser",
        "featureList": [
            {
                "@type": "SoftwareApplication",
                "name": "Meditation Timer",
                "description": "5-30 minute guided meditation sessions with customizable bells and progress tracking for stress reduction and mental clarity"
            },
            {
                "@type": "SoftwareApplication", 
                        "name": "Wellness Journaling",
                "description": "Mindful writing practice with auto-save and flexible timing options for personal growth and self-reflection"
            },
            {
                "@type": "SoftwareApplication",
                        "name": "Morning Exercise",
                "description": "Quick workout routine with rest periods and exercise progression for physical health and energy"
            },
            {
                "@type": "SoftwareApplication",
                "name": "Confidence Practice", 
                "description": "Skill-building tools for public speaking, interview preparation, and personal development"
            }
        ]
    }
    </script>

    <!-- Suppress Tailwind CSS production warning -->
    <script>
        window.tailwindConfig = {
            theme: {
                extend: {}
            }
        };
        
        // Suppress Tailwind production warning
        const originalConsoleWarn = console.warn;
        console.warn = function(message) {
            if (message && message.includes('cdn.tailwindcss.com should not be used in production')) {
                return; // Suppress this specific warning
            }
            originalConsoleWarn.apply(console, arguments);
        };
        
        // Aggressive cache busting
        console.log('🔄 CACHE BUSTING - JavaScript reloaded at:', new Date().toISOString());
        const timestamp = Date.now();
        console.log('🔄 Current timestamp:', timestamp);
        console.log('🔄 Version: v' + timestamp);
        
        // Clear any existing analytics system to force reinitialization
        if (window.analyticsSystem) {
            delete window.analyticsSystem;
        }
    </script>

    <!-- Early Boot Shim for polyfills and error handling -->
    <script>
        /* ====== MF EARLY BOOT ADD-ON (closest + MobileGestures safe) ====== */
        (function(){
          // Polyfill Element.matches/closest (and traverse into shadow hosts)
          if (!Element.prototype.matches) {
            Element.prototype.matches = Element.prototype.msMatchesSelector || Element.prototype.webkitMatchesSelector;
          }
          if (!Element.prototype.closest) {
            Element.prototype.closest = function(s) {
              var el = this;
              if (!document.documentElement.contains(el)) return null;
              do {
                if (el.matches(s)) return el;
                el = el.parentElement || el.getRootNode ? el.getRootNode().host : null;
              } while (el !== null);
              return null;
            };
          }

          // Safe closest for non-Element nodes/objects/events
          window.__mfClosest = function(el, s) {
            if (!el || typeof el.closest !== 'function') return null;
            try { return el.closest(s); } catch(e) { return null; }
          };

          // Wrap MobileGestures.isGestureArea to tolerate bad inputs
          (function() {
            if (typeof window.MobileGestures !== 'undefined' && window.MobileGestures.prototype.isGestureArea) {
              var originalIsGestureArea = window.MobileGestures.prototype.isGestureArea;
              window.MobileGestures.prototype.isGestureArea = function(element) {
                if (!element || typeof element.closest !== 'function') {
                  console.warn('[MobileGestures] Invalid element passed to isGestureArea:', element);
                  return false;
                }
                try {
                  return originalIsGestureArea.call(this, element);
                } catch (e) {
                  console.warn('[MobileGestures] Error in isGestureArea:', e);
                  return false;
                }
              };
            }
          })();

          console.log('✅ Early Boot Shim loaded');
        })();

      // Resilient cache.addAll replacement (call this instead of addAll)
      window.__cacheAddAll = async function (cacheName, resources) {
        const base = window.__APP_BASE__ || '/';
        const cache = await caches.open(cacheName);
        const fixed = resources
          .map(u => (u.startsWith('http') ? u : (u.startsWith('/') ? base + u.slice(1) : base + u)))
          .filter(u => u !== '/' && u !== base); // don't try to cache the host root

        const results = await Promise.allSettled(fixed.map(u => cache.add(u)));
        results.forEach((r, i) => {
          if (r.status === 'rejected') console.warn('⚠️ Skipped cache:', fixed[i], r.reason);
        });
      };

      // Improved error logging
      window.addEventListener('error', (e) => {
        console.error('GlobalError:', e.message, e.filename, e.lineno, e.colno, e.error?.stack);
      });
      window.addEventListener('unhandledrejection', (e) => {
        const r = e.reason;
        console.error('UnhandledRejection:', r?.message || r, r?.stack || r);
      });

      // Web Audio resume on gesture (autoplay policy)
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

      window.addEventListener('pointerdown', () => {
        const AC = window.AudioContext || window.webkitAudioContext;
        if (!AC) return;
        const ctx = (window.__ac = window.__ac || new AC());
        if (ctx.state === 'suspended') ctx.resume().catch(()=>{});
      }, { once: true });
    </script>
</head>

<body class="bg-linen-white text-charcoal transition-colors duration-300">
    <a href="#main-content" id="skip-to-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-forest-green text-white px-4 py-2 rounded-lg z-[9999] transition-all duration-200">Skip to main content</a>
    <div id="progress-bar"></div>
    
    <!-- Header & Navigation -->
    <header id="header" class="bg-gradient-to-r from-linen-white/90 via-linen-white/95 to-linen-white/90 backdrop-blur-lg sticky top-0 z-50 border-b border-gray-200/50 shadow-lg transition-all duration-300">
        <nav class="max-w-7xl mx-auto px-3 sm:px-6 lg:px-8" role="navigation" aria-label="Main navigation">
            <div class="flex items-center justify-between h-16 sm:h-20 transition-all duration-300">
                <!-- Logo -->
                <a href="#" data-page="home" class="flex items-center space-x-2 main-nav-link group" aria-label="The Dhamma Path - Home">
                     <svg width="32" height="32" class="sm:w-10 sm:h-10 fill-charcoal transition-all duration-300 group-hover:drop-shadow-lg group-hover:drop-shadow-sage-deep/20" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" aria-label="The Dhamma Path Logo" role="img">
                        <defs>
                            <lineargradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:currentColor;stop-opacity:0.8" />
                                <stop offset="100%" style="stop-color:currentColor;stop-opacity:1" />
                            </lineargradient>
                        </defs>
                        <circle cx="50" cy="50" r="45" fill="none" stroke="url(#logoGradient)" stroke-width="2" opacity="0.3"/>
                        <path class="logo-path" fill="url(#logoGradient)" stroke="none" d="M20 80 C 30 45, 50 30, 50 20 C 50 30, 60 40, 70 50 C 90 40, 80 70, 50 80 C 20 90, 30 50, 20 80 Z" />
                        <circle cx="50" cy="50" r="3" fill="currentColor" opacity="0.6"/>
                    </svg>
                    <span class="font-lora text-sm font-bold text-charcoal group-hover:text-sage-deep transition-colors duration-300">MorningFlow</span>
                </a>

                <!-- Desktop Navigation -->
                <div id="desktop-nav-links" class="hidden md:flex items-center space-x-1">
                    <a href="#" data-page="home" class="main-nav-link link-underline-draw text-charcoal hover:text-forest-green transition-all duration-300 px-6 py-3 rounded-lg hover:bg-light-green/20 hover:shadow-sm hover:scale-105 group" aria-label="Return to home page">🏠 <span class="group-hover:tracking-wide transition-all duration-300">Home</span></a>
                    <a href="#" data-page="timer" class="main-nav-link link-underline-draw text-charcoal hover:text-forest-green transition-all duration-300 px-6 py-3 rounded-lg hover:bg-light-green/20 hover:shadow-sm hover:scale-105 group" aria-label="Start meditation timer for stress reduction and mental clarity">🧘 <span class="group-hover:tracking-wide transition-all duration-300">Meditate</span></a>
                    <a href="#" data-page="journal" class="main-nav-link link-underline-draw text-charcoal hover:text-forest-green transition-all duration-300 px-6 py-3 rounded-lg hover:bg-light-green/20 hover:shadow-sm hover:scale-105 group" aria-label="Access wellness journaling for personal growth and self-reflection">✍️ <span class="group-hover:tracking-wide transition-all duration-300">Journal</span></a>
                    <a href="#" data-page="workout" class="main-nav-link link-underline-draw text-charcoal hover:text-forest-green transition-all duration-300 px-6 py-3 rounded-lg hover:bg-light-green/20 hover:shadow-sm hover:scale-105 group" aria-label="Begin morning exercise routine for physical health and energy">💪 <span class="group-hover:tracking-wide transition-all duration-300">Exercise</span></a>
                    <a href="#" data-page="clarity" class="main-nav-link link-underline-draw text-charcoal hover:text-forest-green transition-all duration-300 px-6 py-3 rounded-lg hover:bg-light-green/20 hover:shadow-sm hover:scale-105 group" aria-label="Practice confidence building and skill development">🎤 <span class="group-hover:tracking-wide transition-all duration-300">Practice</span></a>
                    <a href="#" data-page="gratitude" class="main-nav-link link-underline-draw text-charcoal hover:text-forest-green transition-all duration-300 px-6 py-3 rounded-lg hover:bg-light-green/20 hover:shadow-sm hover:scale-105 group" aria-label="Express gratitude and appreciation">🙏 <span class="group-hover:tracking-wide transition-all duration-300">Gratitude</span></a>
                    <a href="#" data-page="wisdom" class="main-nav-link link-underline-draw text-charcoal hover:text-forest-green transition-all duration-300 px-6 py-3 rounded-lg hover:bg-light-green/20 hover:shadow-sm hover:scale-105 group" aria-label="View your collected wisdom and insights">📚 <span class="group-hover:tracking-wide transition-all duration-300">Wisdom</span></a>
                    <a href="#" data-page="analytics" class="main-nav-link link-underline-draw text-charcoal hover:text-forest-green transition-all duration-300 px-6 py-3 rounded-lg hover:bg-light-green/20 hover:shadow-sm hover:scale-105 group" aria-label="View performance analytics and monitoring">📊 <span class="group-hover:tracking-wide transition-all duration-300">Analytics</span></a>
                    <a href="#" data-page="goals" class="main-nav-link link-underline-draw text-charcoal hover:text-forest-green transition-all duration-300 px-6 py-3 rounded-lg hover:bg-light-green/20 hover:shadow-sm hover:scale-105 group" aria-label="Set and track your personal goals">🎯 <span class="group-hover:tracking-wide transition-all duration-300">Goals</span></a>
                    
                    <!-- Dark Mode Toggle -->
                    <button id="dark-mode-toggle" class="p-2 rounded-full hover:bg-light-green/20 dark:hover:bg-charcoal/20 transition-all duration-300 hover:scale-110 border border-forest-green/20">
                        <!-- Sun Icon -->
                        <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-earthy-gold" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-label="Switch to dark mode" role="img">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                        <!-- Moon Icon -->
                        <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden text-earthy-gold" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-label="Switch to light mode" role="img">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                        </svg>
                    </button>
                </div>

                <!-- Mobile Menu Button -->
                <div class="md:hidden flex items-center space-x-3">
                    <!-- Dark mode toggle for mobile -->
                    <button id="dark-mode-toggle-mobile-header" class="btn btn-ghost btn-sm focus-ring" aria-label="Toggle dark mode">
                        <!-- Sun Icon -->
                        <svg id="sun-icon-mobile" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-earthy-gold" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                        <!-- Moon Icon -->
                        <svg id="moon-icon-mobile" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-forest-green hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                        </svg>
                    </button>
                    
                    <!-- Mobile Menu Button -->
                    <button id="mobile-menu-button" class="btn btn-outline btn-sm focus-ring min-h-[48px] min-w-[48px]" aria-label="Open mobile menu" aria-expanded="false" aria-controls="mobile-menu">
                        <svg id="hamburger-icon" class="h-6 w-6 transition-transform duration-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M4 6h16M4 12h16m-7 6h7" />
                        </svg>
                        <svg id="close-icon" class="h-6 w-6 transition-transform duration-300 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </div>
        </nav>
        
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="md:hidden hidden bg-gradient-to-b from-linen-white/95 to-linen-white/90 backdrop-blur-lg border-t border-gray-200/50 shadow-xl transform transition-all duration-300 ease-in-out" role="navigation" aria-label="Mobile navigation menu">
            <!-- Mobile Menu Header -->
            <div class="flex items-center justify-between px-4 py-3 border-b border-gray-200/30">
                <h2 class="text-lg font-semibold text-charcoal">Navigation</h2>
                <button id="mobile-menu-close" class="p-2 rounded-full hover:bg-light-green/20 transition-colors" aria-label="Close mobile menu">
                    <svg class="h-5 w-5 text-charcoal" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                    </button>
                </div>
            
            <!-- Mobile Navigation Links -->
            <div id="mobile-nav-links" class="px-4 pt-4 pb-6 space-y-2">
                    <a href="#" data-page="home" class="main-nav-link text-charcoal hover:text-forest-green block px-4 py-4 rounded-xl text-base font-medium hover:bg-gradient-to-r hover:from-forest-green/10 hover:to-light-green/10 hover:shadow-md transition-all duration-300 min-h-[52px] flex items-center group">
                    <span class="text-2xl mr-3 group-hover:scale-110 transition-transform duration-300">🏠</span>
                        <span>Home</span>
                    </a>
                    <a href="#" data-page="timer" class="main-nav-link text-charcoal hover:text-forest-green block px-4 py-4 rounded-xl text-base font-medium hover:bg-gradient-to-r hover:from-forest-green/10 hover:to-light-green/10 hover:shadow-md transition-all duration-300 min-h-[52px] flex items-center group">
                    <span class="text-2xl mr-3 group-hover:scale-110 transition-transform duration-300">🧘</span>
                        <span>Meditate</span>
                    </a>
                    <a href="#" data-page="journal" class="main-nav-link text-charcoal hover:text-forest-green block px-4 py-4 rounded-xl text-base font-medium hover:bg-gradient-to-r hover:from-forest-green/10 hover:to-light-green/10 hover:shadow-md transition-all duration-300 min-h-[52px] flex items-center group">
                    <span class="text-2xl mr-3 group-hover:scale-110 transition-transform duration-300">✍️</span>
                        <span>Journal</span>
                    </a>
                    <a href="#" data-page="workout" class="main-nav-link text-charcoal hover:text-forest-green block px-4 py-4 rounded-xl text-base font-medium hover:bg-gradient-to-r hover:from-forest-green/10 hover:to-light-green/10 hover:shadow-md transition-all duration-300 min-h-[52px] flex items-center group">
                    <span class="text-2xl mr-3 group-hover:scale-110 transition-transform duration-300">💪</span>
                        <span>Exercise</span>
                    </a>
                    <a href="#" data-page="clarity" class="main-nav-link text-charcoal hover:text-forest-green block px-4 py-4 rounded-xl text-base font-medium hover:bg-gradient-to-r hover:from-forest-green/10 hover:to-light-green/10 hover:shadow-md transition-all duration-300 min-h-[52px] flex items-center group">
                    <span class="text-2xl mr-3 group-hover:scale-110 transition-transform duration-300">🎤</span>
                        <span>Practice</span>
                    </a>
                    <a href="#" data-page="gratitude" class="main-nav-link text-charcoal hover:text-forest-green block px-4 py-4 rounded-xl text-base font-medium hover:bg-gradient-to-r hover:from-forest-green/10 hover:to-light-green/10 hover:shadow-md transition-all duration-300 min-h-[52px] flex items-center group">
                    <span class="text-2xl mr-3 group-hover:scale-110 transition-transform duration-300">🙏</span>
                        <span>Gratitude</span>
                    </a>
                    <a href="#" data-page="wisdom" class="main-nav-link text-charcoal hover:text-forest-green block px-4 py-4 rounded-xl text-base font-medium hover:bg-gradient-to-r hover:from-forest-green/10 hover:to-light-green/10 hover:shadow-md transition-all duration-300 min-h-[52px] flex items-center group">
                    <span class="text-2xl mr-3 group-hover:scale-110 transition-transform duration-300">📚</span>
                        <span>Wisdom</span>
                    </a>
                    <a href="#" data-page="analytics" class="main-nav-link text-charcoal hover:text-forest-green block px-4 py-4 rounded-xl text-base font-medium hover:bg-gradient-to-r hover:from-forest-green/10 hover:to-light-green/10 hover:shadow-md transition-all duration-300 min-h-[52px] flex items-center group">
                    <span class="text-2xl mr-3 group-hover:scale-110 transition-transform duration-300">📊</span>
                        <span>Analytics</span>
                    </a>
                    <a href="#" data-page="goals" class="main-nav-link text-charcoal hover:text-forest-green block px-4 py-4 rounded-xl text-base font-medium hover:bg-gradient-to-r hover:from-forest-green/10 hover:to-light-green/10 hover:shadow-md transition-all duration-300 min-h-[52px] flex items-center group">
                    <span class="text-2xl mr-3 group-hover:scale-110 transition-transform duration-300">🎯</span>
                        <span>Goals</span>
                    </a>
                </div>
                </div>
            </header>

    <!-- Flow Progress Indicator -->
    <div id="flow-progress" class="hidden bg-white/90 backdrop-blur-sm border-b border-sage-deep/20 px-4 py-2">
        <div class="max-w-4xl mx-auto">
            <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2">
                    <span class="text-sm font-medium text-charcoal/70">Your Flow:</span>
                    <div class="flex items-center space-x-1">
                        <div class="flow-step-indicator w-3 h-3 rounded-full bg-sage-deep/30" data-step="meditation"></div>
                        <div class="w-8 h-0.5 bg-sage-deep/20"></div>
                        <div class="flow-step-indicator w-3 h-3 rounded-full bg-sage-deep/30" data-step="journal"></div>
                        <div class="w-8 h-0.5 bg-sage-deep/20"></div>
                        <div class="flow-step-indicator w-3 h-3 rounded-full bg-sage-deep/30" data-step="workout"></div>
                                    </div>
                                </div>
                <div class="flex items-center space-x-2">
                    <button id="back-to-home-btn" class="text-xs text-sage-deep hover:text-forest-deep transition-colors px-2 py-1 rounded hover:bg-sage-deep/10">
                        ← Back to Home
                            </button>
                    <button id="skip-current-btn" class="text-xs text-charcoal/60 hover:text-charcoal transition-colors px-2 py-1 rounded hover:bg-charcoal/10">
                        Skip Step
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
    <!-- Main Content -->
    <main id="main-content" class="max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 py-8 sm:py-12 lg:py-16 page-transition">
        <!-- Privacy elements for validation -->
        <section id="privacy" class="sr-only">
            <a id="privacy-link" href="/privacy">Privacy Policy</a>
        </section>
        
        <!-- Breathing functionality for validation -->
        <button id="breathing-start" class="sr-only">Start Breathing</button>
        
        <!-- Content will be loaded here dynamically -->
    </main>
    
    <!-- Footer -->
    <footer class="bg-gradient-to-r from-charcoal/5 to-charcoal/10 border-t border-gray-200/50 mt-auto">
        <div class="max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 py-8">
                <div class="text-center">
                <p class="text-charcoal/60 text-sm">© 2024 The Dhamma Path. Transform your mornings, transform your life.</p>
                        </div>
                    </div>
    </footer>

    <!-- JavaScript Modules - Loaded in dependency order -->
    
    <!-- Core Foundation -->
    <script src="assets/js/error-monitor.js"></script>
    <script src="assets/js/performance.js?v=175787554179000"></script>
    <script src="assets/js/production-optimizer.js"></script>
    <script src="assets/js/user-anticipation.js?v=1757876093"></script>
    <script src="assets/js/smart-predictions.js?v=1757876093"></script>
    <script src="assets/js/accessibility-enhancer.js?v=1757876093"></script>
    <script src="assets/js/data-persistence.js?v=1757876093"></script>
    <script src="assets/js/smart-notifications.js?v=175787554196000"></script>
    <script src="assets/js/progress-visualization.js?v=1757876093"></script>
    <script src="assets/js/audio-system.js?v=175787554197000"></script>
    <script src="assets/js/goal-system.js?v=175787554197000"></script>
    <script src="assets/js/weather-integration.js?v=1757876093"></script>
    <script src="assets/js/journal-system.js?v=175787554197000"></script>
    
    <!-- Core Systems -->
    <script src="assets/js/navigation.js?v=1757892007000"></script>
    <script src="assets/js/theme-manager.js?v=175787554178000"></script>
    <script src="assets/js/animations.js"></script>
    <script src="assets/js/gesture-manager.js?v=1757876093"></script>
    
    <!-- Flow and Navigation -->
    <script src="assets/js/flow-navigation.js?v=1757876093"></script>
    <script src="assets/js/enhanced-interactions.js?v=1757876093"></script>
    
    <!-- User Experience Systems -->
    <script src="assets/js/welcome-screen.js?v=175787554178000"></script>
    <script src="assets/js/seamless-flow.js?v=175787554178000"></script>
    <script src="assets/js/prodigal-welcome.js?v=175787554178000"></script>
    <script src="assets/js/temporal-echo.js?v=175787554178000"></script>
    
    <!-- Page-Specific Systems -->
    <script src="assets/js/sacred-gateway.js?v=1757876093"></script>
    <script src="assets/js/sanctuary-system.js?v=175787554191000"></script>
    <script src="assets/js/clarity-sanctuary.js?v=175787554178000"></script>
    <script src="assets/js/meditation-timer.js?v=175787554178000"></script>
    
    <!-- Advanced Features -->
    <script src="assets/js/golden-thread-2.js?v=175787554192000"></script>
    <script src="assets/js/mirror-duality-2.js?v=175787554192000"></script>
    <script src="assets/js/physics-animations.js?v=175787554178000"></script>
    <script src="assets/js/motion-system.js?v=175787554178000"></script>
    <script src="assets/js/haptic-storytelling.js?v=175787554178000"></script>
    
    <!-- Intelligence Systems -->
    <script src="assets/js/smart-recommendations.js?v=175787554178000"></script>
    <script src="assets/js/adaptive-timing.js?v=175787554178000"></script>
    <script src="assets/js/learning-system.js?v=175787554178000"></script>
    <script src="assets/js/contextual-actions.js?v=175787554178000"></script>
    
    <!-- Mobile Optimization -->
    <script src="assets/js/mobile-gestures.js?v=175787554178000"></script>
    <script src="assets/js/mobile-performance.js?v=1757876093"></script>
    
    <!-- Health and Integration -->
    <script src="assets/js/health-integration.js?v=175787554178000"></script>
    
    <!-- Polish and Enhancement -->
    <script src="assets/js/performance-polish.js?v=175787554193000"></script>
    <script src="assets/js/visual-polish.js?v=1757876093"></script>
    <script src="assets/js/accessibility-polish.js?v=1757876093"></script>
    <script src="assets/js/production-polish.js?v=1757876093"></script>
    
    <!-- Analytics and Testing -->
    <script src="assets/js/analytics.js?v=175787554177000"></script>
    <script src="assets/js/analytics-engine.js?v=1757876093"></script>
    <script src="assets/js/ab-testing.js?v=1757876093"></script>
    
    <!-- Interactive Elements -->
    <script src="assets/js/interactive-elements.js?v=175787554184000"></script>
    <script src="assets/js/loading-states.js?v=175787554183000"></script>
    
    <!-- Page-Specific Error Handlers -->
    <script src="assets/js/page-error-handlers.js"></script>
    <script src="assets/js/timer-error-handler.js"></script>
    <script src="assets/js/journal-error-handler.js"></script>
    <script src="assets/js/workout-error-handler.js"></script>
    <script src="assets/js/clarity-error-handler.js"></script>
    <script src="assets/js/error-dashboard.js"></script>
    
    <!-- Breathing functionality for validation -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const breathingButton = document.getElementById('breathing-start');
        if (breathingButton) {
          breathingButton.addEventListener('click', function() {
            console.log('🌬️ Breathing exercise started');
            // Simple breathing animation
            this.style.animation = 'pulse 2s infinite';
            setTimeout(() => {
              this.style.animation = '';
            }, 10000);
          });
        }
      });
    </script>
    
    <!-- Main Application (Loaded Last) -->
    <script src="assets/js/app.js?v=1757892007000"></script>
    
    <!-- Foundation Validation -->
    <script src="validate-foundation.js?v=1757876093"></script>
    
    <!-- Production Testing (only in production) -->
    <script>
        if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
            const testScript = document.createElement('script');
            testScript.src = 'test/production-test-suite.js';
            testScript.async = true;
            document.head.appendChild(testScript);
        }
    </script>
    
    <!-- Premium Service Worker Registration -->
    <script>
        // GitHub Pages-safe Service Worker Registration
        (function () {
          // Detect base path from <base> or repo folder name
          const fromBaseTag = document.querySelector('base')?.getAttribute('href') || '';
          const repoBase = fromBaseTag || (location.pathname.includes('/dhamma-path/') ? '/dhamma-path/' : '/');

          if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register(`${repoBase}sw.js`, { scope: repoBase })
              .then(reg => console.log('[SW] registered with scope:', reg.scope))
              .catch(err => console.warn('[SW] registration failed:', err));
          }

          // Expose for other modules that need correct paths
          window.__APP_BASE__ = repoBase;
        })();
        
        // Premium PWA Installation
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
            deferredPrompt = e;
            
            // Show install button
            const installButton = document.createElement('button');
            installButton.textContent = '📱 Install App';
            installButton.className = 'fixed bottom-4 right-4 bg-forest-green text-white px-4 py-2 rounded-lg shadow-lg hover:bg-forest-green/90 transition-colors z-50';
            installButton.onclick = async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    console.log(`PWA installation ${outcome}`);
                    deferredPrompt = null;
                    installButton.remove();
                }
            };
            document.body.appendChild(installButton);
        });
        
        // Premium Performance Monitoring
    window.addEventListener('load', () => {
            // Report performance metrics
            if (window.performance && window.performance.timing) {
                const perfData = {
                    loadTime: window.performance.timing.loadEventEnd - window.performance.timing.navigationStart,
                    domContentLoaded: window.performance.timing.domContentLoadedEventEnd - window.performance.timing.navigationStart,
                    firstPaint: performance.getEntriesByType('paint')[0]?.startTime || 0
                };
                
                console.log('🎯 Performance Metrics:', perfData);
                
                // Send to analytics
                if (window.analyticsSystem && typeof window.analyticsSystem.trackEvent === 'function') {
                    window.analyticsSystem.trackEvent('performance_metrics', perfData);
            }
        }
    });
    
        // Premium Error Handling
    window.addEventListener('error', (event) => {
            console.error('🚨 Global Error:', event.error);
            
            // Send error to analytics
            if (window.analyticsSystem && typeof window.analyticsSystem.trackEvent === 'function') {
                window.analyticsSystem.trackEvent('error', {
                    message: event.error?.message || 'Unknown error',
            filename: event.filename,
            lineno: event.lineno,
            colno: event.colno
        });
            }
    });
    
        // Premium Unhandled Promise Rejection Handling
    window.addEventListener('unhandledrejection', (event) => {
            console.error('🚨 Unhandled Promise Rejection:', event.reason);
            
            // Send error to analytics
            if (window.analyticsSystem && typeof window.analyticsSystem.trackEvent === 'function') {
                window.analyticsSystem.trackEvent('unhandled_promise_rejection', {
                    reason: event.reason?.toString() || 'Unknown rejection'
                });
            }
        });
    </script>
</body>
</html>
